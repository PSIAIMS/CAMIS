---
title: "Sample Size for Superiority Trials in SAS"
output: html_document
date: last-modified
date-format: D MMMM, YYYY
---

SAS has 2 procedures for doing Sample size. A basic summary is provided here but see the Jenny Cody paper^1^ for more details.

PROC POWER is used for sample size calculations for tests such as:

-   t tests, equivalence tests, and confidence intervals for means,

-   tests, equivalence tests, and confidence intervals for binomial proportions,

-   multiple regression,

-   tests of correlation and partial correlation,

-   one-way analysis of variance,

-   rank tests for comparing two survival curves,

-   logistic regression with binary response,

-   Wilcoxon-Mann-Whitney (rank-sum) test (SAS, 2010).

PROC GLMPOWER is used for sample size calculations for more complex linear models, and cover Type III tests and contrasts of fixed effects in univariate linear models with or without covariates. (SAS, 2011).

### **Comparing means for parallel design (unpaired)**

In the most common scenario SDs are assumed known and the same in both treatment groups. Otherwise Student t distribution is used instead of the normal distribution. SAS follows the Satterthwaite method, .

#### Example: same SDs

A client is interested in conducting a clinical trial to compare two cholesterol lowering agents for treatment of hypercholesterolemic patients. The primary efficacy parameter is a low-density lipidprotein cholesterol (LDL-C). Suppose that a difference of 8% in the percent change of LDL-C is considered a clinically meaningful difference and that the standard deviation is assumed to be 15%. What sample size is required for a two-sided false positive rate of 5% and a power of 80%?

The code below estimates the sample size in SAS. NOTE: you can either specify the MEANDIFF=8 or if you only know the separate group means, you can use GROUPMEANS =8\|16 instead. SAS also assume a default alpha level of 0.05, Normal distribution.

```{r eval=FALSE}
PROC POWER  ;
 TWOSAMPLEMEANS TEST=DIFF
 MEANDIFF=8
 STDDEV=15
 NTOTAL=.
 POWER=0.8
 ;
RUN;
```

```{r, echo=FALSE, fig.align='center', out.width="50%"}
knitr::include_graphics("../images/sample_s_superiority/SAS2sampmeans.png")
```

```         
# samplesize: n.ttest(power = 0.8, alpha = 0.05, mean.diff = 8, sd1 = 15,         k = 1, design = "unpaired", fraction = "balanced", variance = "equal")
```

```         
$`Total sample size` [1] 114  $`Sample size group 1` [1] 57  $`Sample size group 2` [1] 57
```

```         
#stats: power.t.test(delta=8, sd=15, sig.level=0.05, power=0.8,               type="two.sample", alternative="two.sided")
```

```         
      Two-sample t test power calculation                 n = 56.16413           delta = 8              sd = 15       sig.level = 0.05           power = 0.8     alternative = two.sided  NOTE: n is number in *each* group
```

```         
#pwr: pwr.t.test(d = 8/15, sig.level = 0.05, power = 0.80,             type = "two.sample", alternative = "two.sided")
```

```         
      Two-sample t test power calculation                 n = 56.164               d = 0.5333333       sig.level = 0.05           power = 0.8     alternative = two.sided  NOTE: n is number in *each* group
```

### **Comparing means for crossover design (paired)**

It is important to differenciate here between the within patient SD and the SD of the difference. We may need to recalculate one to the other, depending on the case.

Variance of the difference = 2x Variance within patient.Vardiff=2∗Varpatient

#### Example

We wish to run an AB/BA single dose crossover to compare two brochodilators. The primary outcome is peak expiratory flow, and a clinically relevant difference of 30 l/min is sought with 80% power, the significance level is 5% and the best estimate of the within patient standard deviation is 32 l/min. What size of trial do we require?

(After recalculating:32∗2=45)

```         
# samplesize: n.ttest(power = 0.8, alpha = 0.05, mean.diff = 30, sd1 = 45,         k = 1, design = "paired", fraction = "balanced")
```

```         
$`Total sample size` [1] 20
```

```         
#stats: power.t.test(delta=30, sd=45, sig.level=0.05, power=0.8,               type="one.sample", alternative="two.sided")
```

```         
      One-sample t test power calculation                 n = 19.66697           delta = 30              sd = 45       sig.level = 0.05           power = 0.8     alternative = two.sided
```

```         
#pwr: pwr.t.test(d = 30/45, sig.level = 0.05, power = 0.80,             type = "one.sample", alternative = "two.sided")
```

```         
      One-sample t test power calculation                 n = 19.66695               d = 0.6666667       sig.level = 0.05           power = 0.8     alternative = two.sided
```

### References

1.  [Sample Size Calculation Using SAS®, R, and nQuery Software, 2020 Jenna Cody, Paper 4675-2020](https://support.sas.com/resources/papers/proceedings20/4675-2020.pdf)
2.  

### Version

```{r}
#| echo: false
si <- sessioninfo::session_info("rmst", dependencies = FALSE) 
si$external <- structure(list("SAS" = "9.04.01M7P08062020"), 
                         class = c("external_info", "list")) 
si
```
