---
title: "Wilcoxon signed-rank test in SAS & StatXact®"
---

### **Introduction**

Similarily to what has been presented in R, we will explore the options of Wilcoxon Signed-Rank test that are avialable in SAS & StatXact.We will consider case with N\>=20 or N\<20 and without or with ties. For more information how to perform this analysis in R go [here](../R/wilcoxonsr_hodges_lehman.qmd)

### Data {.unnumbered}

Analysis was be conducted on the same example dataset as in R.

Again, wilcoxon signed rank test was applied to analyse the time to return to baseline FEV1 post-mannitol challenge 2. 

## Analysis in SAS {.unnumbered}

### Dataset without ties and N > 20 {.unnumbered}

Let's consider a case where the dataset has no ties and N (number of observations) = 240.

```{r}
#| eval: false
data TTR;
  set TTR;
  diff = TRT_B - TRT_A;
run;
```

```{r, echo=FALSE, fig.align='center', out.width="75%"}
knitr::include_graphics("../images/wilcoxonsr/wsr_data.PNG")
```

In SAS Wilcoxon Signed-Rank test is available using PROC UNIVARIATE.

```{r}
#| eval: false
proc univariate data=TTR
	alpha=0.1;
	var diff;
run;
```

```{r, echo=FALSE, fig.align='center', out.width="75%"}
knitr::include_graphics("../images/wilcoxonsr/wsr_240.PNG")
```

### Dataset without ties and N≤20 {.unnumbered}

Now let's consider a smaller dataset, created by selecting first 19 observations from our main data.

```{r}
#| eval: false
data TTR_19;
    set TTR;
    if _N_ <= 19;
run;
```

```{r}
#| eval: false
proc univariate data=TTR_19
	alpha=0.1;
	var diff;
run;
```


```{r, echo=FALSE, fig.align='center', out.width="75%"}
knitr::include_graphics("../images/wilcoxonsr/wsr_19.PNG")
```

### Important notes on SAS {.unnumbered}

-   Only PROC UNIVARIATE can be used in SAS to perform Wilcoxon Signed-Rank test. SAS documentation details are [here](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/procstat/procstat_univariate_syntax01.htm).
-   In regards to Wilcoxon S-R test, SAS provides only p value 
-   Hodges-Lehmann estimator or CI are not available and have to be implemented manually
-   Provided p value is based on Signed Rank (S) statistic (modification of a common T+). Details are [here](https://blogs.sas.com/content/iml/2023/07/19/wilcoxon-signed-rank.html)
-   SAS computes exact p values only for N ≤ 20. For larger samples uses an asymptotic t-Student distribution of the test statistic. For more information how the p value is calculated go [here](https://support.sas.com/documentation/cdl/en/procstat/63104/HTML/default/viewer.htm#procstat_univariate_sect029.htm)
-   PROC UNIVARIATE apart from performing Wilcoxon S-R test presents as well basic statistical measures of variability and location, e.g median. The given median is not a "pseudo-median" (median of the Walsh averages), it is a "normal" median of the considered variable.
-   Using CIQUANTNORMAL option we can get confidence limits for quantiles based on normal distribution. There are 5 different definitions for calculation quantiles  available. See details from the SAS documentation [here](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/procstat/procstat_univariate_details14.htm). It is important to note, those are not confidence intervals of estimator.

### Approach to 0s and ties in SAS {.unnumbered}
-   In SAS all the 0 differences are disregarded (Hollander and Wolfe, 1973). The sample size N is reduced to reflect the number of discarded zeros. 
-   Tied differences are given an average of the ranks. Statistic S is updated accordingly following Sprent algorythm (Sprent, 1993).

## Analysis in StatXact® {.unnumbered}
StatXact® PROCs for SAS users is a clinical trial analysis software from Cytel for exact statistics. Package includes more than 150 procedures for exact inference statistical data and power analysis.
 
 
### Dataset without ties and N > 20 {.unnumbered}
```{r}
#| eval: false
/* Wilxocon S-R test - p values */
PROC PAIRED DATA=WilcoxonSignedRank_TTR
ALPHA=0.9;
WI/EX;
POPS TRT_B - TRT_A;
RUN;
```


```{r, echo=FALSE, fig.align='center', out.width="75%"}
knitr::include_graphics("../images/wilcoxonsr/wsrSX_240a.PNG")
```

```{r}
#| eval: false
/* Wilcoxon S-R - H-L estimator and CI */
PROC PAIRED DATA=WilcoxonSignedRank_TTR 
ALPHA=0.9;
HL/EX;
POPS TRT_B - TRT_A;
RUN;
```


```{r, echo=FALSE, fig.align='center', out.width="75%"}
knitr::include_graphics("../images/wilcoxonsr/wsrSX_240b.PNG")
```

### Important notes on StatXact® {.unnumbered}
-   Only PROC PAIRED can be used in StatXact to perform Wilcoxon Signed-Rank test
-   Follows Sprent (1993) approach for Wilcoxon Signed-Rank test and Lehmann (1975) for H-L estimate and CI
-   Provides exact/non-exact p values, (exact) H-L estimator and exact/non-exact CIs
-   p value is based on a common T+ statistic (sum of ranks of the positive differences)


### Approach to 0s and ties in StatXact® {.unnumbered}
-   Using ZEROS option we can compute H-L estimate including all differences, but by default 0s are excluded.
-   Tied differences are given an average of the ranks. Statistic S is updated accordingly following Sprent algorythm (Sprent, 1993).
