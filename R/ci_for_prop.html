<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Confidence Intervals for Proportions in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ebfcb0ed0ac0539375ffcf22e0e9fa78.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contribution/contribution.html"> 
<span class="menu-text">Contribute</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-publications-and-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Publications and projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-publications-and-projects">    
        <li>
    <a class="dropdown-item" href="../publication/white_paper.html">
 <span class="dropdown-text">White paper</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../publication/conference.html">
 <span class="dropdown-text">Conferences</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../publication/dissertation.html">
 <span class="dropdown-text">Academic projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-news" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">News</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-news">    
        <li>
    <a class="dropdown-item" href="../minutes/index.html">
 <span class="dropdown-text">Meeting minutes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../blogs/index.html">
 <span class="dropdown-text">Blogs</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/PSIAIMS/CAMIS/">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/PSIAIMS/CAMIS/issues/">
            Report a Difference
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-used" id="toc-data-used" class="nav-link" data-scroll-target="#data-used">Data used</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#methods-for-calculating-confidence-intervals-for-a-single-proportion-using-cardx" id="toc-methods-for-calculating-confidence-intervals-for-a-single-proportion-using-cardx" class="nav-link" data-scroll-target="#methods-for-calculating-confidence-intervals-for-a-single-proportion-using-cardx">Methods for Calculating Confidence Intervals for a single proportion using cardx</a>
  <ul class="collapse">
  <li><a href="#clopper-pearson-exact-or-binomial-ci-method" id="toc-clopper-pearson-exact-or-binomial-ci-method" class="nav-link" data-scroll-target="#clopper-pearson-exact-or-binomial-ci-method">Clopper-Pearson (Exact or binomial CI) Method</a></li>
  <li><a href="#normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method" id="toc-normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method" class="nav-link" data-scroll-target="#normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method">Normal Approximation Method (Also known as the Wald or asymptotic CI Method)</a></li>
  <li><a href="#wilson-method-also-known-as-the-score-method-or-the-altman-newcombe-method3" id="toc-wilson-method-also-known-as-the-score-method-or-the-altman-newcombe-method3" class="nav-link" data-scroll-target="#wilson-method-also-known-as-the-score-method-or-the-altman-newcombe-method3">Wilson Method (Also known as the Score method or the Altman, Newcombe method<sup>3</sup> )</a></li>
  <li><a href="#agresti-coull-method" id="toc-agresti-coull-method" class="nav-link" data-scroll-target="#agresti-coull-method">Agresti-Coull Method</a></li>
  <li><a href="#jeffreys-method" id="toc-jeffreys-method" class="nav-link" data-scroll-target="#jeffreys-method">Jeffreys Method</a></li>
  </ul></li>
  <li><a href="#methods-for-calculating-confidence-intervals-for-a-matched-pair-proportion-using-exactcidiff" id="toc-methods-for-calculating-confidence-intervals-for-a-matched-pair-proportion-using-exactcidiff" class="nav-link" data-scroll-target="#methods-for-calculating-confidence-intervals-for-a-matched-pair-proportion-using-exactcidiff">Methods for Calculating Confidence Intervals for a matched pair proportion using {ExactCIdiff}</a></li>
  <li><a href="#methods-for-calculating-confidence-intervals-for-2-independent-samples-proportion" id="toc-methods-for-calculating-confidence-intervals-for-2-independent-samples-proportion" class="nav-link" data-scroll-target="#methods-for-calculating-confidence-intervals-for-2-independent-samples-proportion">Methods for Calculating Confidence Intervals for 2 independent samples proportion</a>
  <ul class="collapse">
  <li><a href="#normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method-using-cardx" id="toc-normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method-using-cardx" class="nav-link" data-scroll-target="#normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method-using-cardx">Normal Approximation Method (Also known as the Wald or asymptotic CI Method) using {cardx}</a></li>
  <li><a href="#normal-approximation-wald-and-other-methods-for-2-independent-samples-using-desctools" id="toc-normal-approximation-wald-and-other-methods-for-2-independent-samples-using-desctools" class="nav-link" data-scroll-target="#normal-approximation-wald-and-other-methods-for-2-independent-samples-using-desctools">Normal Approximation (Wald) and Other Methods for 2 independent samples using {DescTools}</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Confidence Intervals for Proportions in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The methods to use for calculating a confidence interval (CI) for a proportion depend on the type of proportion you have.</p>
<ul>
<li><p>1 sample proportion (1 proportion calculated from 1 group of subjects)</p></li>
<li><p>2 sample proportions and you want a CI for the difference in the 2 proportions.</p>
<ul>
<li><p>If the 2 samples come from 2 independent samples (different subjects in each of the 2 groups)</p></li>
<li><p>If the 2 samples are matched (i.e.&nbsp;the same subject has 2 results, one on each group [paired data]).</p></li>
</ul></li>
</ul>
<p>The method selected is also dependent on whether your proportion is close to 0 or 1 (or near to the 0.5 midpoint), and your sample size.</p>
<p>For more information about these methods, including which performs better in different scenarios see <a href="https://towardsdatascience.com/five-confidence-intervals-for-proportions-that-you-should-know-about-7ff5484c024f">Five Confidence Intervals for Proportions That You Should Know about</a><sup>1</sup>.</p>
</section>
<section id="data-used" class="level2">
<h2 class="anchored" data-anchor-id="data-used">Data used</h2>
<p>The adcibc data stored <a href="../data/adcibc.csv">here</a> was used in this example, creating a binary treatment variable <code>trt</code> taking the values of <code>ACT</code> or <code>PBO</code> and a binary response variable <code>resp</code> taking the values of <code>Yes</code> or <code>No</code>. For this example, a response is defined as a score greater than 4.</p>
<p>The below shows that for the Actual Treatment, there are 36 responders out of 154 subjects = 0.234 (23.4% responders).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   trt [2]
  trt   resp      n
  &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
1 ACT   No      118
2 ACT   Yes      36
3 PBO   No       65
4 PBO   Yes      12</code></pre>
</div>
</div>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p><strong>The {cardx} package</strong> is an extension of the {cards} package, providing additional functions to create Analysis Results Data Objects (ARDs)<sup>1</sup>. It was developed as part of {NEST} and pharmaverse. This package requires the binary endpoint to be a logical (TRUE/FALSE) vector or a numeric/integer coded as (0, 1) with 1 (TRUE) being the success you want to calculate the confidence interval for.</p>
<p>See <a href="R:%20Functions%20for%20Calculating%20Proportion%20Confidence%20Intervals">here</a> for full description of the {cardx} proportions equations.</p>
<p>If calculating the CI for a difference in proportions, the package requires both the response and the treatment variable to be numeric/integer coded as (0, 1) (or logical vector).</p>
<p>Instead of the code presented below, you can use <code>ard_categorical_ci(data, variables=resp, method ='wilson')</code> for example. This invokes the code below but returns an analysis results dataset (ARD) format as the output. Methods included are waldcc, wald, clopper-pearson, wilson, wilsoncc, strat_wilson, strat_wilsoncc, agresti-coull and jeffreys for one-sample proportions and methods for 2 independent samples, however currently does not have a method for 2 matched proportions.</p>
<p>Code example: <code>proportion_ci_clopper_pearson(&lt;resp_var&gt;,conf.level=0.95) %&gt;%    as_tibble()</code></p>
<p>Example data format needed for {cardx} for a single proportion CI</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 0 0 0 1 1 0 0 1 1 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0</code></pre>
</div>
</div>
<p><strong>The {PropCIs} package</strong> produces CIs for methods such as Blaker’s exact method and Midp which aren’t available in {cardx} but are available in SAS. We found results agreed with SAS to the 5th decimal place. The package also calculates CIs for Clopper-Pearson, Wald, Wilson, Agresti-Coull and these align to results obtained in cardx to at least the 7th decimal place. The {PropsCIs} package requires just the number of events (numerator number of successes) &amp; total number of subjects (denominator) as an input dataset. Given Blaker and Midp are rarely used in practice, and {PropsCIs} isn’t a package commonly downloaded from CRAN, further detail is not provided here.</p>
<p>Code example for Clopper-pearson:<br>
<code>exactci(x=&lt;count of successes&gt; , n=&lt;Total&gt;, conf.level=0.95)</code></p>
<p>Code example for Mid P method:<br>
<code>midPci(x=&lt;count of successes&gt; , n=&lt;Total&gt;, conf.level=0.95)</code></p>
<p>Code example for Blaker’s exact method:<br>
<code>blakerci(x=&lt;count of successes&gt; , n=&lt;Total&gt;, conf.level=0.95, tolerance=1e-05)</code></p>
<p><strong>The {Hmisc} package</strong> produces CIs using the Clopper-Pearson method. In this example (x=36 and n=154), the results match the cardx package. Documentation reports that the method uses F distribution to compute exact intervals based on the binomial cdf. However, if the percentage of responders is 100% then the upper limit is set to 1. Similarly if the percentage of responders is 0%, then the lower limit is set to 0. Hence, in extreme cases there may be differences between this package and the standard implementation of Clopper-Pearson method.</p>
<p>Code example for Clopper-pearson:<br>
<code>binconf(x=&lt;count of successes&gt; , n=&lt;Total&gt;,method="exact",alpha=0.05)</code></p>
<p><strong>The {RBesT} package (Prior to Version 1.8-0)</strong> produces CIs using the Clopper-Pearson method. In this example (x=36 and n=154), the results match the cardx package. However, as described below, there are 2 cases where the results using RBesT package do not match cardx or Hmisc.</p>
<ol type="1">
<li>x = 0 (0% responders), in which case the lower limit does not match.</li>
<li>x = n (100% responders), in which case the upper limit does not match.</li>
</ol>
<p>Because of the relationship between the binomial distribution and the beta distribution. This package uses quantiles of the beta distribution to derive exact confidence intervals.</p>
<p><span class="math display">\[ B(\alpha/2;x, n-x+1) &lt; p &lt; B(1-\alpha/2; x+1, n-x)\]</span></p>
<p>RBesT equations are:<br>
pLow &lt;- qbeta(Low, r + (r == 0), n - r + 1)<br>
pHigh &lt;- qbeta(High, r + 1, n - r + ((n - r) == 0))</p>
<p>In Version 1.8-0 onwards the equations were updated as follows, which then match the Hmisc intervals:<br>
pLow &lt;- qbeta(Low, r, n - r + 1)<br>
pHigh &lt;- qbeta(High, r + 1, n - r)</p>
<p><code>BinaryExactCI(x=&lt;count of successes&gt; , n=&lt;Total&gt;,alpha=0.05)</code></p>
<p><strong>The {ExactCIdiff} package</strong> produces exact CIs for two dependent proportions (matched pairs).</p>
<p><strong>The {DescTools} package</strong> has a function BinomDiffCI which produces CIs for two independent proportions (unmatched pairs) including methods for Agresti/Caffo, Wald, Wald with Continuity correction, Newcombe Score, Newcombe score with continuity correction, and more computationally intensive methods such as Miettinen and Nurminen, Mee, Brown Li’s Jeffreys, Hauck-Anderson and Haldane. See <a href="https://search.r-project.org/CRAN/refmans/DescTools/html/BinomDiffCI.html">here</a> for more detail. Code is of the form.</p>
<p><code>BinomDiffCI(x1, n1, x2, n2, conf.level = 0.95, sides =c("two.sided","left","right"),             method = c("ac", "wald", "waldcc", "score", "scorecc", "mn",                        "mee", "blj", "ha", "hal", "jp"))</code></p>
<p><strong>The {presize} package</strong> has a function prec_prop() which also calculates CIs for 2 independent samples using the Wilson, Agresti-Coull, Exact or Wald approaches. The package is not described in further detail here since in most cases <strong>{DescTools}</strong> will be able to compute what is needed. However, it’s mentioned due to other functionality it has available such as sample size and precision calculations for AUC, correlations, cronbach’s alpha, intraclass correlation, Cohen’s kappa, likelihood ratios, means, mean differences, odds ratios, rates, rate ratios, risk differences and risk ratios.</p>
</section>
<section id="methods-for-calculating-confidence-intervals-for-a-single-proportion-using-cardx" class="level2">
<h2 class="anchored" data-anchor-id="methods-for-calculating-confidence-intervals-for-a-single-proportion-using-cardx">Methods for Calculating Confidence Intervals for a single proportion using cardx</h2>
<p>For more technical derivation and reasons for use of each of the methods listed below, see the corresponding <a href="https://psiaims.github.io/CAMIS/SAS/ci_for_prop.html">SAS page</a>.</p>
<p>Let’s start by calculating a Confidence interval for the proportion of successes observed in the Active Treatment group (a single sample).</p>
<section id="clopper-pearson-exact-or-binomial-ci-method" class="level3">
<h3 class="anchored" data-anchor-id="clopper-pearson-exact-or-binomial-ci-method">Clopper-Pearson (Exact or binomial CI) Method</h3>
<p>Clopper-Pearson Exact CI is one of the most popular methods, it is often good for small sample sizes when the proportion is not close to the tails (0,1), but it can be too conservative (too wide an interval compared to the interval containing the true population proportion 95% of the time).</p>
<p>The cardx package calculates the Clopper-Pearson score by calling stats::binom.test() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_clopper_pearson</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
      N conf.level estimate statistic  p.value parameter conf.low conf.high
  &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1   154       0.95    0.234        36 2.21e-11       154    0.169     0.309
# ℹ 2 more variables: method &lt;chr&gt;, alternative &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method" class="level3">
<h3 class="anchored" data-anchor-id="normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method">Normal Approximation Method (Also known as the Wald or asymptotic CI Method)</h3>
<p>In large random samples from independent trials, the sampling distribution of proportions approximately follows the normal distribution. The expectation of a sample proportion is the corresponding population proportion. Therefore, based on a sample of size <span class="math inline">\(n\)</span>, a <span class="math inline">\((1-\alpha)\%\)</span> confidence interval for population proportion can be calculated using normal approximation as follows:</p>
<p><span class="math inline">\(p\approx \hat p \pm z_\alpha \sqrt{\hat p(1-\hat p)}/{n}\)</span>, where <span class="math inline">\(\hat p\)</span> is the sample proportion, <span class="math inline">\(z_\alpha\)</span> is the <span class="math inline">\(1-\alpha/2\)</span> quantile of a standard normal distribution corresponding to level <span class="math inline">\(\alpha\)</span>, and <span class="math inline">\(\sqrt{\hat p(1-\hat p)}/{n}\)</span> is the standard error.</p>
<p>For more technical information see the corresponding <a href="https://psiaims.github.io/CAMIS/SAS/ci_for_prop.html">SAS page</a>.</p>
<section id="example-code" class="level4">
<h4 class="anchored" data-anchor-id="example-code">Example code</h4>
<p>The following code calculates a confidence interval for a binomial proportion using normal approximation equation manually. This is replicated exactly using the <code>cardx::proportion_ci_wald function</code> which also allows the continuity correction to be applied.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample proportion by trt</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> adcibc <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(trt<span class="sc">==</span><span class="st">"ACT"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">group_by</span>(resp) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tally</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">total=</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">p=</span>n<span class="sc">/</span>total)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate standard error and 95% wald confidence intervals for population proportion</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>waldci <span class="ot">&lt;-</span>summary <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(resp<span class="sc">==</span><span class="st">"Yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">se=</span><span class="fu">sqrt</span>(p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">/</span>total)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">lower_ci=</span>(p<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="fl">-0.05</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>se)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">upper_ci=</span>(p<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="fl">-0.05</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>se)) </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>waldci  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  resp      n total     p     se lower_ci upper_ci
  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 Yes      36   154 0.234 0.0341    0.167    0.301</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cardx package Wald method without continuity correction</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_wald</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>,<span class="at">correct=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
      N estimate conf.low conf.high conf.level method                           
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;glue&gt;                           
1   154    0.234    0.167     0.301       0.95 Wald Confidence Interval without…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cardx package Wald method with continuity correction</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_wald</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>,<span class="at">correct=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
      N estimate conf.low conf.high conf.level method                           
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;glue&gt;                           
1   154    0.234    0.164     0.304       0.95 Wald Confidence Interval with co…</code></pre>
</div>
</div>
</section>
</section>
<section id="wilson-method-also-known-as-the-score-method-or-the-altman-newcombe-method3" class="level3">
<h3 class="anchored" data-anchor-id="wilson-method-also-known-as-the-score-method-or-the-altman-newcombe-method3">Wilson Method (Also known as the Score method or the Altman, Newcombe method<sup>3</sup> )</h3>
<p>The cardx package calculates the Wilson (score) method by calling stats::prop.test() function. This method is often used as a compromise between the Clopper-Pearson and the Wald given it was found to be accurate for most parameter values (even those close to 0 and 1), and it does not suffer from being over-conservative. For more technical information see the corresponding <a href="https://psiaims.github.io/CAMIS/SAS/ci_for_prop.html">SAS page</a>.</p>
<p>The package also contains a function for proportion_ci_strat_wilson() which calculates the stratified Wilson CIs for unequal proportions as described on page 47 <a href="https://cran.r-universe.dev/cardx/cardx.pdf">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cardx package Wilson method without continuity correction</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_wilson</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>,<span class="at">correct=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
      N conf.level estimate statistic  p.value parameter conf.low conf.high
  &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1   154       0.95    0.234      43.7 3.90e-11         1    0.174     0.307
# ℹ 2 more variables: method &lt;glue&gt;, alternative &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cardx package Wilson method with continuity correction</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_wilson</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>,<span class="at">correct=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
      N conf.level estimate statistic  p.value parameter conf.low conf.high
  &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1   154       0.95    0.234      42.6 6.70e-11         1    0.171     0.310
# ℹ 2 more variables: method &lt;glue&gt;, alternative &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="agresti-coull-method" class="level3">
<h3 class="anchored" data-anchor-id="agresti-coull-method">Agresti-Coull Method</h3>
<p>The cardx package calculates the Agresti-Coull method using the equation from the published method by Alan Agresti &amp; Brent Coull based on adding 2 successes and 2 failures before computing the wald CI. The CI is truncated, when it overshoots the boundary (&lt;0 or &gt;1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cardx package agresti_coull method </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_agresti_coull</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
      N estimate conf.low conf.high conf.level method                           
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                            
1   154    0.234    0.174     0.307       0.95 Agresti-Coull Confidence Interval</code></pre>
</div>
</div>
</section>
<section id="jeffreys-method" class="level3">
<h3 class="anchored" data-anchor-id="jeffreys-method">Jeffreys Method</h3>
<p>Jeffreys method is a particular type of Bayesian Highest Probability Density (HPD) Method. For proportions, the beta distribution is generally used for the prior, which consists of two parameters alpha and beta. Setting alpha=beta=0.5 is called Jeffrey’s prior. NOTE: if you want to use any other priors, you can use <code>binom.bayes</code> which estimates a credible interval for proportions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cardx package jeffreys method </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion_ci_jeffreys</span>(act2,<span class="at">conf.level=</span><span class="fl">0.95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
      N estimate conf.low conf.high conf.level method           
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;glue&gt;           
1   154    0.234    0.172     0.305       0.95 Jeffreys Interval</code></pre>
</div>
</div>
<pre><code></code></pre>
</section>
</section>
<section id="methods-for-calculating-confidence-intervals-for-a-matched-pair-proportion-using-exactcidiff" class="level2">
<h2 class="anchored" data-anchor-id="methods-for-calculating-confidence-intervals-for-a-matched-pair-proportion-using-exactcidiff">Methods for Calculating Confidence Intervals for a matched pair proportion using {ExactCIdiff}</h2>
<p>For more information about the detailed methods for calculating confidence intervals for a matched pair proportion see <a href="https://psiaims.github.io/CAMIS/SAS/ci_for_prop.html#methods-for-calculating-confidence-intervals-for-a-matched-pair-proportion">here</a>. When you have 2 measurements on the same subject, the 2 sets of measures are not independent and you have matched pair of responses.</p>
<p>To date we have not found an R package which calculates a CI for matched pair proportions using the normal approximation or Wilson methods although they can be done by hand using the equations provided on the SAS page link above.</p>
<p><strong>The {ExactCIdiff} package</strong> produces exact CIs for two dependent proportions (matched pairs), claiming to be the first package in R to do this method. However, it should only be used when the sample size is not too large as it can be computationally intensive.<br>
NOTE that the {ExactNumCI} package should not be used for this task. More detail on these two packages can be found <a href="RJ-2013-026.pdf">here</a>.</p>
<p>Using a cross over study as our example, a 2 x 2 table can be formed as follows:</p>
<table class="caption-top table">
<caption>The proportions of subjects responding on each treatment are:</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Placebo<br>
Response= Yes</th>
<th>Placebo<br>
Response = No</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Active Response = Yes</td>
<td>r</td>
<td>s</td>
<td>r+s</td>
</tr>
<tr class="even">
<td>Active Response = No</td>
<td>t</td>
<td>u</td>
<td>t+u</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>r+t</td>
<td>s+u</td>
<td>N = r+s+t+u</td>
</tr>
</tbody>
</table>
<p>Active: <span class="math inline">\(\hat p_1 = (r+s)/n\)</span> and Placebo: <span class="math inline">\(\hat p_2= (r+t)/n\)</span></p>
<p>Difference between the proportions for each treatment are: <span class="math inline">\(D=p1-p2=(s-t)/n\)</span></p>
<p>Suppose :</p>
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Placebo<br>
Response= Yes</th>
<th>Placebo<br>
Response = No</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Active Response = Yes</td>
<td>r = 20</td>
<td>s = 15</td>
<td>r+s = 35</td>
</tr>
<tr class="even">
<td>Active Response = No</td>
<td>t = 6</td>
<td>u = 5</td>
<td>t+u = 11</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>r+t = 26</td>
<td>s+u = 20</td>
<td>N = r+s+t+u = 46</td>
</tr>
</tbody>
</table>
<p>Active: <span class="math inline">\(\hat p_1 = (r+s)/n\)</span> =35/46 =0.761 and Placebo: <span class="math inline">\(\hat p_2= (r+t)/n\)</span> = 26/46 =0.565</p>
<p>Difference = 0.761-0.565 = 0.196, then PairedCI() function can provide an exact confidence interval as shown below</p>
<p>(-0.00339 to 0.38065)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ExactCIdiff: PairedCI(s, r+u, t, conf.level = 0.95)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>CI<span class="ot">&lt;-</span><span class="fu">PairedCI</span>(<span class="dv">15</span>, <span class="dv">25</span>, <span class="dv">6</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)<span class="sc">$</span>ExactCI</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="methods-for-calculating-confidence-intervals-for-2-independent-samples-proportion" class="level2">
<h2 class="anchored" data-anchor-id="methods-for-calculating-confidence-intervals-for-2-independent-samples-proportion">Methods for Calculating Confidence Intervals for 2 independent samples proportion</h2>
<p>This <a href="https://www.lexjansen.com/wuss/2016/127_Final_Paper_PDF.pdf">paper</a><sup>4</sup> describes many methods for the calculation of confidence intervals for 2 independent proportions.</p>
<section id="normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method-using-cardx" class="level3">
<h3 class="anchored" data-anchor-id="normal-approximation-method-also-known-as-the-wald-or-asymptotic-ci-method-using-cardx">Normal Approximation Method (Also known as the Wald or asymptotic CI Method) using {cardx}</h3>
<p>For more technical information regarding the Wald method see the corresponding <a href="https://psiaims.github.io/CAMIS/SAS/ci_for_prop.html">SAS page</a>.</p>
<section id="example-code-1" class="level4">
<h4 class="anchored" data-anchor-id="example-code-1">Example code</h4>
<p><code>cardx::ard_stats_prop_test function</code> uses <code>stats::prop.test</code> which also allows a continuity correction to be applied.</p>
<p>Although this website <a href="https://rdrr.io/r/stats/prop.test.html">here</a> and this one <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/prop.test">here</a> both reference Newcombe for the CI that this function uses, replication of the results by hand and compared to SAS show that the results below match the Normal Approximation (Wald method).</p>
<p>Both the Treatment variable (ACT,PBO) and the Response variable (Yes,No) have to be numeric (0,1) or Logit (TRUE,FALSE) variables.</p>
<p>The prop.test default with 2 groups, is the null hypothesis that the proportions in each group are the same and a 2-sided CI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>indat1<span class="ot">&lt;-</span> adcibc2 <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AVAL,TRTP) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resp=</span><span class="fu">if_else</span>(AVAL<span class="sc">&gt;</span><span class="dv">4</span>,<span class="st">"Yes"</span>,<span class="st">"No"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">respn=</span><span class="fu">if_else</span>(AVAL<span class="sc">&gt;</span><span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt=</span><span class="fu">if_else</span>(TRTP<span class="sc">==</span><span class="st">"Placebo"</span>,<span class="st">"PBO"</span>,<span class="st">"ACT"</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trtn=</span><span class="fu">if_else</span>(TRTP<span class="sc">==</span><span class="st">"Placebo"</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(trt,trtn,resp, respn) </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cardx package required a vector with 0 and 1s for a single proportion CI</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># To get the comparison the correct way around Placebo must be 1, and Active 0</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>indat<span class="ot">&lt;-</span> <span class="fu">select</span>(indat1, trtn,respn)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>cardx<span class="sc">::</span><span class="fu">ard_stats_prop_test</span>(<span class="at">data=</span>indat, <span class="at">by=</span>trtn, <span class="at">variables=</span>respn, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">correct=</span><span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>{cards} data frame: 13 x 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   group1 variable   context   stat_name stat_label      stat
1    trtn    respn stats_pr…    estimate  Rate Dif…     0.078
2    trtn    respn stats_pr…   estimate1  Group 1 …     0.234
3    trtn    respn stats_pr…   estimate2  Group 2 …     0.156
4    trtn    respn stats_pr…   statistic  X-square…     1.893
5    trtn    respn stats_pr…     p.value    p-value     0.169
6    trtn    respn stats_pr…   parameter  Degrees …         1
7    trtn    respn stats_pr…    conf.low  CI Lower…    -0.027
8    trtn    respn stats_pr…   conf.high  CI Upper…     0.183
9    trtn    respn stats_pr…      method     method 2-sample…
10   trtn    respn stats_pr… alternative  alternat… two.sided
11   trtn    respn stats_pr…           p          p          
12   trtn    respn stats_pr…  conf.level  CI Confi…      0.95
13   trtn    respn stats_pr…     correct  Yates' c…     FALSE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ 3 more variables: fmt_fn, warning, error</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cardx<span class="sc">::</span><span class="fu">ard_stats_prop_test</span>(<span class="at">data=</span>indat, <span class="at">by=</span>trtn, <span class="at">variables=</span>respn, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">correct=</span><span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>{cards} data frame: 13 x 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   group1 variable   context   stat_name stat_label      stat
1    trtn    respn stats_pr…    estimate  Rate Dif…     0.078
2    trtn    respn stats_pr…   estimate1  Group 1 …     0.234
3    trtn    respn stats_pr…   estimate2  Group 2 …     0.156
4    trtn    respn stats_pr…   statistic  X-square…      1.45
5    trtn    respn stats_pr…     p.value    p-value     0.229
6    trtn    respn stats_pr…   parameter  Degrees …         1
7    trtn    respn stats_pr…    conf.low  CI Lower…    -0.037
8    trtn    respn stats_pr…   conf.high  CI Upper…     0.193
9    trtn    respn stats_pr…      method     method 2-sample…
10   trtn    respn stats_pr… alternative  alternat… two.sided
11   trtn    respn stats_pr…           p          p          
12   trtn    respn stats_pr…  conf.level  CI Confi…      0.95
13   trtn    respn stats_pr…     correct  Yates' c…      TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ 3 more variables: fmt_fn, warning, error</code></pre>
</div>
</div>
</section>
</section>
<section id="normal-approximation-wald-and-other-methods-for-2-independent-samples-using-desctools" class="level3">
<h3 class="anchored" data-anchor-id="normal-approximation-wald-and-other-methods-for-2-independent-samples-using-desctools">Normal Approximation (Wald) and Other Methods for 2 independent samples using {DescTools}</h3>
<p>For more technical information regarding the derivations of these methods see the corresponding <a href="https://psiaims.github.io/CAMIS/SAS/ci_for_prop.html">SAS page</a> or {DescTools} package documentation <a href="https://search.r-project.org/CRAN/refmans/DescTools/html/BinomDiffCI.html">here</a>. <strong>The {DescTools} package</strong> has a function BinomDiffCI which produces CIs for two independent proportions (unmatched pairs) including methods for Agresti/Caffo, Wald, Wald with Continuity correction, Newcombe Score, Newcombe score with continuity correction, and more computationally intensive (less commonly used) methods such as Miettinen and Nurminen, Mee, Brown Li’s Jeffreys, Hauck-Anderson, Haldane and Jeffreys-Perks.</p>
<section id="example-code-2" class="level4">
<h4 class="anchored" data-anchor-id="example-code-2">Example code</h4>
<p>With 2 groups, the null hypothesis that the proportions in each group are the same and a 2-sided CI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>count_dat <span class="ot">&lt;-</span> indat <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">count</span>(trtn,respn)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>count_dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
   trtn respn     n
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
1     0     0   118
2     0     1    36
3     1     0    65
4     1     1    12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the BinomDiffCI requires x1=successes in active, n1=total subjects in active,</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                          x2=successes in placebo, n2=total subjects in placebo,</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">BinomDiffCI</span>(<span class="at">x1=</span><span class="dv">36</span>, <span class="at">n1=</span><span class="dv">154</span>, <span class="at">x2=</span><span class="dv">12</span>, <span class="at">n2=</span><span class="dv">77</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">sides=</span><span class="fu">c</span>(<span class="st">"two.sided"</span>), <span class="at">method=</span><span class="fu">c</span>(<span class="st">"wald"</span>,<span class="st">"waldcc"</span>,<span class="st">"score"</span>,<span class="st">"scorecc"</span>,<span class="st">"ac"</span>,<span class="st">"mn"</span>,<span class="st">"mee"</span>,<span class="st">"blj"</span>,<span class="st">"ha"</span>,<span class="st">"hal"</span>,<span class="st">"jp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               est      lwr.ci    upr.ci
wald    0.07792208 -0.02710792 0.1829521
waldcc  0.07792208 -0.03684818 0.1926923
score   0.07792208 -0.03614191 0.1751254
scorecc 0.07792208 -0.04396244 0.1809901
ac      0.07792208 -0.03292487 0.1781699
mn      0.07792208 -0.03606525 0.1774952
mee     0.07792208 -0.03580439 0.1772849
blj     0.07792208 -0.03062424 0.1810792
ha      0.07792208 -0.03415013 0.1899943
hal     0.07792208 -0.03143484 0.1769438
jp      0.07792208 -0.03207751 0.1776615</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li><a href="https://insightsengineering.github.io/cardx/main/#:~:text=The%20%7Bcardx%7D%20package%20is%20an%20extension%20of%20the,Data%20Objects%20%28ARDs%29%20using%20the%20R%20programming%20language.">pharmaverse cardx package</a></li>
<li><a href="https://cran.r-project.org/web//packages/PropCIs/PropCIs.pdf">PropCIs package</a></li>
<li>D. Altman, D. Machin, T. Bryant, M. Gardner (eds). Statistics with Confidence: Confidence Intervals and Statistical Guidelines, 2nd edition. John Wiley and Sons 2000.</li>
<li><a href="https://www.lexjansen.com/wuss/2016/127_Final_Paper_PDF.pdf" class="uri">https://www.lexjansen.com/wuss/2016/127_Final_Paper_PDF.pdf</a></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>