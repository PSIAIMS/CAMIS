---
title: "ANOVA"
---

### **Getting Started**

To demonstrate the various types of sums of squares, we'll create a data frame called `df_disease` taken from the SAS documentation. 

```{r}
#| echo: false
#| include: false
library(tidyverse)
library(emmeans)
library(broom)
library(knitr)

knitr::opts_chunk$set(echo = TRUE)

df_disease <- 
  read_csv(
    file = "../data/sas_disease.csv",
    col_types = cols(drug    = col_factor(),
                     disease = col_factor(),
                     y       = col_double()))
```

### The Model {.unnumbered}

For this example, we're testing for a significant difference in `stem_length` using ANOVA. In R, we're using `lm()` to run the ANOVA, and then using `broom::glance()` and `broom::tidy()` to view the results in a table format.

```{r}
lm_model <- lm(y ~ drug + disease + drug*disease, df_disease)
```

The `glance` function gives us a summary of the model diagnostic values.

```{r}
lm_model %>% 
  glance() %>% 
  pivot_longer(everything())
```

The `tidy` function gives a summary of the model results.

```{r}
lm_model %>% tidy()
```

### The Results {.unnumbered}

You'll see that R print the individual results for each level of the drug and disease interaction. We can get the combined F table in R using the `anova()` function on the model object.

```{r}
lm_model %>% 
  anova() %>% 
  tidy() %>% 
  kable()
```

We can add a `Total` row, by using `add_row` and calculating the sum of the degrees of freedom and sum of squares.

```{r}
lm_model %>%
  anova() %>%
  tidy() %>%
  add_row(term = "Total", df = sum(.$df), sumsq = sum(.$sumsq)) %>% 
  kable()
```

### Sums of Squares Tables {.unnumbered}

Unfortunately, it is not easy to get the various types of sums of squares calculations in using functions from base R. However, the `rstatix` package offers a solution to produce these various sums of squares tables. For each type, you supply the original dataset and model to the. `anova_test` function, then specify the ttype and se `detailed = TRUE`.

#### Type I

```{r}
#| message: false
#| warning: false
df_disease %>% 
  rstatix::anova_test(
    y ~ drug + disease + drug*disease, 
    type = 1, 
    detailed = TRUE) %>% 
  rstatix::get_anova_table() %>% 
  kable()
```

#### Type II {.unnumbered}

```{r}
#| message: false
#| warning: false
df_disease %>% 
  rstatix::anova_test(
    y ~ drug + disease + drug*disease, 
    type = 2, 
    detailed = TRUE) %>% 
  rstatix::get_anova_table() %>% 
  kable()
```

#### Type III {.unnumbered}

```{r}
#| message: false
#| warning: false
df_disease %>% 
  rstatix::anova_test(
    y ~ drug + disease + drug*disease, 
    type = 3, 
    detailed = TRUE) %>% 
  rstatix::get_anova_table() %>% 
  kable()
```

#### Type IV {.unnumbered}

In R there is no equivalent operation to the `Type IV` sums of squares calculation in SAS.
