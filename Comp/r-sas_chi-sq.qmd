---
title: "R/SAS Chi-Squared and Fisher's Exact Comparision" 
format: html
project:
  include:
    -images/
---

# Chi-Squared Test

Chi-Squared test is a hypothesis test for independent contingency tables, dependent on rows and column totals. The test assumes:

-   observations are independent of each other

-   all values are 1 or more and at least 80% of the cells are greater than 5.

-   data should be categorical

The Chi-Squared statistic is found by:

$$ \chi^2=\frac{\sum(O-E)^2}{E} $$

Where O is the observed and E is the expected.\
For an r x c table (where r is the number of rows and c the number of columns), the Chi-squared distribution's degrees of freedom is (r-1)\*(c-1). The resultant statistic with correct degrees of freedom follows this distribution when its expected values are aligned with the assumptions of the test, under the null hypothesis. The resultant p value informs the magnitude of disagreement with the null hypothesis and not the magnitude of association

For this example we will use data about cough symptoms and history of bronchitis.

```{r}

bronch <- matrix(c(26, 247, 44, 1002), ncol = 2)
row.names(bronch) <- c("cough", "no-cough")
colnames(bronch) <- c("bronchitis", "no-bronchitis")

print(bronch)
```


To a chi-squared test in R you will use the following code. Here the chisq.test() function has a `correct` argument with default value as TRUE, so it generates the `Continuity Adj. Chi-Square` results that match with the `proc freq`  results.

```{r}
chisq.test(bronch)
```

To run a chi-squared test in SAS we used the following code.

```{S}
#| eval: false 

proc freq data=bronchitis; 
tables cough*bronchitis / chisq fisher alpha=0.05;
exact oddsratio; 
run;
```

::: {layout="\[100\]"}

![](./images/ci_for_prop/chi_square.png){fig-align="center" width="50%"}

:::

If we change this argument `correct` to `false`.The result in the `Chi-Square` section of the results table in SAS will match R.

```{r}
chisq.test(bronch, correct = FALSE)
```

# Fisher's Exact Test

::: {layout="\[100\]"}

![](./images/ci_for_prop/fisher_test.png){fig-align="center" width="50%" .lightbox}

:::

```{r}

fisher.test(bronch)
```

Comparison between the Fisher's Exact Test in both R and SAS shows that the two software match approximately on the odd ratio, p-value and confidence intervals. Both return similar results but can differ slightly in precision and computational approaches. The reason the odds ratio does not match is because R uses an "exact" odds ratio based on the hypergeomtric distribution, while SAS uses a standard AD/BC odds ratio. Note that R always uses an "exact" Fisher test. Therefore, when trying to match SAS, you must use the "exact" statement on the PROC FREQ.

More details could be found [here](https://online.stat.psu.edu/stat504/lesson/4/4.5).