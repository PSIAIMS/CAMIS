---
title: "Generalized Estimating Equations (GEE) methods"
---

# Comparison of SAS vs R

# BINARY OUTCOME

For dichotomous response variables, the link functions is the probit (in case of rare events complementary log-log may be preferable). For outcomes with more than two categories, the cumulative link function is used in case of ordinal variables and generalized logit for nominal variables.

In SAS, PROC GEE or PROC GENMOD can be used to compute GEE models. In R, GEE models can be fitted using `geepack::geeglm` or `gee::gee.`

Estimated probabilities and odds ratios (OR) can be obtained in SAS by adding an `LSMEANS` statement, and in R by using an additional function with results from `geepack::geeglm`. For models fitted with `gee::gee`, the `emmeans` package is not supported.

The table below summarizes options and details for each procedure/function:

| **Procedure/Function** | geepack::geeglm | **gee:gee** | PROC GEE/GENMOD |
|------------------|------------------|-------------------|------------------|
| Outcome variable | Numeric (0, 1) | Factor | Numeric or character in `class` statement |
| Correlation matrix (default) | Independence | Independence | Independence |
| Correlation matrix (options) | independence, exchangeable, ar1, unstructured and user defined. | independence, fixed, stat_M_dep, non_stat_M_dep, exchangeable, AR-M and unstructured. | independence, ar, exchangeable, mdep, unstructured and user defined. |
| Outcome variable | Numeric (0, 1) | Factor | Numeric or factor, in `class` statement |
| Sandwich SE | By default | By default | By default |
| Model-based (naive) SE | No | By default | `modelse` option in `repeated` statement |
| Link functions | probit, logit | probit, logit | probit, logit, clogit and glogit |
| Estimated probability of event | additional function `emmeans::emmeans` | `emmeans::emmeans` not supported | `LSMEANS` statement with `ilink` option |
| Odds Ratio (OR) | additional function `emmeans::emmeans` | `emmeans::emmeans` not supported | `LSMEANS` statement with `exp` or `oddsraio`option |

A comparison between SAS (using PROC GEE) and the R functions using data available in ["Gee Model for Binary Data"](https://documentation.sas.com/doc/en/statug/15.2/statug_code_genmex5.htm), and similar results were found across software using similar options (See R and SAS sections).

Note small differences may be found in later decimal places (\>9 decimal position) in results obtained with PROC GENMOD and PROC GEE. Similarly, differences in later decimals may be found across R functions.

# OUTCOME WITH MORE THAN TWO CATEGORIES

Models with cumulative logit link functions apply to ordinal data and generalized logit models are fit to nominal data.

In SAS, similar syntax used for GEE models can be applied by specifying a multinomial distribution and selecting the appropriate link function. In R, the `multgee`package provides two functions for estimating GEE models when the outcome has more than two categories: `ordLORgee` for ordinal variables and `nomLORgee` for nominal variables.

| **Procedure/Function** | multgee:ordLORgee | multgee:nomLORgee | PROC GEE/PROC GENMOD | PROC GEE/GENMOD |
|---------------|---------------|---------------|---------------|---------------|
| Correlation matrix (default) | Exchangeable | Independence | Independence |  |
| Correlation matrix (options) | independence, uniform, exchangeable, time.exch, fixed | independence, exchangeable, RC or fixed | Independence^(1)^ |  |
| Link function | clogit (implicit - not user configurable) | glogit (implicit - not user configurable) | glogit, glogit^(2)^ |  |
| Model-based (naive) SE | No | By default | `modelse` option in `repeated` statement |  |

(1) For multinomial responses, SAS limits the correlation matrix type to `independent,` so other correlation matrix options are not supported.

(2) Generalized logit is available in PROC GEE, but not in PROC GENMOD.

The same data analyzed in the corresponding section for SAS and R are analyzed to compare results using equivalent settings, i.e.: specifying 'independence' correlation matrix in R to match SAS.

SAS results were stored in a dataset and reformatted to align with R output in terms of order and decimal precision, making visual comparison easier.

### Ordinal variable - Example

```{r}
#| eval: false
proc genmod data=resp ;
class trtp(ref="P") avisitn(ref='1') usubjid ;  
model respord=trtp avisitn trtp*avisitn / dist=multinomial link=cumlogit ; 
repeated subject=usubjid  /corr=ind;  
lsmeans trtp*avisitn/cl exp ilink oddsratio diff;
ods output   GEEEmpPEst=GEEEmpPEst_ord ;
run;
```

```{r}
#| echo: false
#| fig-align: center
#| out-width: 50%
knitr::include_graphics("../images/gee/r_sas_1_ordinal_variable.png")
```

```{r}
#| echo: false
#| include: false
library(geepack)
library(gee)
library(multgee)
library(emmeans)
library(multgee)
library(readxl)
resp <- read_excel("../data/resp_gee.xlsx")
resp$trtp<-factor(resp$trtp, levels=c('P', 'A'))
resp$avisitn<-factor(resp$avisitn)
resp$outcome<-factor(resp$outcome)
resp$usubjid<-factor(resp$usubjid)
resp$respnom<-factor(resp$respnom)
```

```{r}
model <- multgee::ordLORgee(formula = respord ~  trtp + avisitn  + trtp*avisitn,
                   data = resp,
                   id = usubjid,
                   repeated = avisitn,
                   LORstr = "independence")
summary(model)

```

### Nominal variable - Example

```{r}
#| eval: false
proc gee data=resp ;
class trtp(ref="P") avisitn(ref='1') usubjid respnom(ref='Lung');  
model respnom=trtp avisitn trtp*avisitn/ dist=multinomial link=glogit ; 
repeated subject=usubjid  /corr=ind /*modelse*/;  
lsmeans trtp*avisitn/cl exp ilink oddsratio diff;
ods output   GEEEmpPEst=GEEEmpPEst_nom ;
run;
```

```{r}
#| echo: false
#| fig-align: center
#| out-width: 50%
knitr::include_graphics("../images/gee/r_sas_2_nominal_variable.png")
```

```{r}
model <- multgee::nomLORgee(formula = respnom ~  trtp + avisitn  + trtp*avisitn,
                   data = resp,
                   id = usubjid,
                   repeated = avisitn,
                   LORstr = "independence")
summary(model)

```

# REFERENCES

\[1\] [SAS Institute Inc.. SAS Help Center. The GEE procedure.](https://documentation.sas.com/doc/en/statug/15.2/statug_gee_examples01.htm)

\[2\] [SAS/STAT® 13.1 User's Guide The GEE Procedure.](https://support.sas.com/documentation/onlinedoc/stat/141/gee.pdf)

\[3\] [SAS/STAT® 13.1 User's Guide The GENMOD Procedure.](https://support.sas.com/documentation/onlinedoc/stat/131/genmod.pdf)

\[4\] [Generalized Estimating Equation Package](https://cran.r-project.org/web/packages/geepack/geepack.pdf)

\[5\] [Generalized Estimation Equation Solver](https://cran.r-project.org/web/packages/gee/gee.pdf)

\[6\] [Touloumis A. (2015). "R Package multgee: A Generalized Estimating Equations Solver for Multinomial Responses." Journal of Statistical Software.](https://www.jstatsoft.org/article/view/v064i08)
