{
  "hash": "e2a7189083f6edae06e6ca6ee47286d9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Estimating and Testing Cause Specific Hazard Ratio Using SAS\"\n---\n\n\n\n## Objective\n\nIn this document we present how to estimate and test cause specific hazard ratio for the probability of experiencing a certain event at a given time in a competing risks model in SAS (version 9.4). We focus on the basic model where each subject experiences only one out of *k* possible events as depicted in the figure below.\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/survival_competing_risks/cr.jpg){fig-align='center' width=25%}\n:::\n:::\n\n\n\nAs this document aims to provide syntax for estimating and testing cause-specific hazard ratios using Cox's PH model for competing risks, we assume that readers have working knowledge of a competing risks framework. The [Reference] below list a few literature for a quick refresher on this topic.\n\nThe syntax given here produce results match that by R package `survival`, in particular with function `coxph()` (see the companion R document). This is usually necessary if validating results from the two software is the objective.\n\n## SAS procedure\n\nWe use `PROC PHREG` in this document.\n\n### Data used\n\nThe bone marrow transplant (BTM) dataset as presented by Guo & So (2018) is used. The dataset has the following variables:\n\n-   `Group` has three levels, indicating three disease groups.\n\n-   `T` is the disease-free survival time in days. A derived variable `TYears = T/365.25` is used in the analysis.\n\n-   `Status` has value 0 if `T` is censored; 1 if `T` is time to relapse; 2 if `T` is time to death.\n\n-   `WaitTime` is the waiting time to transplant in days.\n\n-   For illustration, a categorical variable `waitCat` is created from `waitTime` as `waitCat = TRUE` if `waitTime > 200`, and `FALSE` otherwise.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc format;\n  value DiseaseGroup 1='ALL'\n                     2='AML-Low Risk'\n                     3='AML-High Risk';\n  value EventStatus  0='Censored'\n                     1='Relapse'\n                     2='Death';\nrun;\nlibname datalib \"..\\data\";\ndata bmt;\n  set datalib.bmt;\n  TYears = T / 365.25;\n  waitCat = (waitTime>200);\n  ID = _n_;\n  format Group DiseaseGroup.;\n  format Status EventStatus.;\nrun;\n```\n:::\n\n\n\n## Estimating and testing the cause specific hazard ratio\n\n### Syntax 1: all events in one go\n\nStarting in SAS/STAT 14.3, all competing events can be estimated together. However, currently this syntax does not allow the `strata` statement.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc phreg data=Bmt;\n\ttitle 'Cause-Specific Hazard Regression for Relapse and Death without strata';\n\tclass Group (order=internal ref=first);\n\tmodel T*Status(0)=Group / eventcode(cox)=1;\nrun;\n```\n:::\n\n\n\nThe results for both events are given below:\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/survival_competing_risks/cshSAS_1.png){fig-align='center' width=100% height=120%}\n:::\n:::\n\n\n\nThree points to note:\n\n1.  The option `eventcode(cox)=1` tells PHREG that `Relapse` (event 1) is the event of interest, and `Death` (event 2) is the competing risk.\n\n2.  This results are essentially the same as modeling `Relapse` and `Death` separately: there are two global hypotheses, one for each event.\n\n3.  This is different from fitting all events in one model that is done in R `coxph()`. In other words, *this is entirely a different model from what R does when modeling all competing events together.* (See Syntax 1 in the Companion R document.)\n\n4.  Additionally, since `strata` statement cannot be incorporated, the results for each event are different from that produced by Syntax 1 in the R document.\n\nFor more information, please see [Guo C and So Y. (2018)](https://support.sas.com/resources/papers/proceedings18/2159-2018.pdf).\n\n### Syntax 2: Estimating one event at a time\n\nWe use `Relapse` as an example.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nods output ParameterEstimates=p1;\nproc phreg data=bmt; \n  title 'Cause-Specific Hazard Regression for Relapse with strata';\n\tclass Group (order=internal ref=first) waitCat;\n\tstrata waitCat;\n\tmodel TYears*Status(0,2) = Group / risklimits alpha = 0.05;\nrun;\nquit;\n```\n:::\n\n\n\nThe results for event `Relapse` are given below:\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/survival_competing_risks/cshSAS_2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\nNote that if there is no stratification, the results will be the same as from Syntax 1 above but for `Relapse` only.\n\n## Summary\n\n-   In `PROC PHREG`, by default Breslow's method is used for handling ties. To match the default results with R `survival::coxph()` which uses Efron's method, this needs to be requested via `ties = efron` option in the `model` statement.\n\n-   For multi-state models such as a competing risk analysis, the R function `survival::coxph()` by default estimate the standard errors of parameter estimates with a robust sandwich estimator. To match results with R, the option `covsandwich` or `covs` for short, need to be added to the `proc phreg` statement.\n\n-   Due to the different internal numerical estimation methods of R and SAS, results only match up to the 4th decimal places. However, overall consistency can be established between the two for estimating and testing cause-specific hazard ratio using Cox's PH model.\n\n## Reference\n\nGuo C and So Y. (2018). \"Cause-specific analysis of competing risks using the PHREG procedure.\" In *Proceedings of the SAS Global Forum 2018 Conference*. Cary, NC: SAS Institute Inc. <https://support.sas.com/resources/papers/proceedings18/2159-2018.pdf>\n\nPintilie M. (2006). *Competing Risks: A Practical Perspective*. Wiley. <http://dx.doi.org/10.1002/9780470870709>\n\nTherneau T, Crowson C, and Atkinson E. (2024). \"Multi-state models and competing risks.\" <https://cran.r-project.org/web/packages/survival/vignettes/compete.pdf>\n",
    "supporting": [
      "survival_csh_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}