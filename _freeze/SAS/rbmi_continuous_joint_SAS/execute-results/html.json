{
  "hash": "bc8f6a7c72d0084317fba6ad65c391fa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"<SAS> <Reference-Based Multiple Imputation (joint modelling): Continuous Data>\"\n---\n\n\n\n## Reference-based multiple imputation (rbmi)\n\n### Methodology introduction\nReference-based multiple imputation methods have become popular for handling missing data, as well as for conducting sensitivity analyses, in randomized clinical trials. In the context of a repeatedly measured continuous endpoint assuming a multivariate normal model, [Carpenter et al. (2013)](https://www.tandfonline.com/doi/full/10.1080/10543406.2013.834911) proposed a framework to extend the usual MAR-based MI approach by postulating assumptions about the joint distribution of pre- and post-deviation data. Under this framework, one makes qualitative assumptions about how individuals’ missing outcomes relate to those observed in relevant groups in the trial, based on plausible clinical scenarios. Statistical analysis then proceeds using the method of multiple imputation ([Rubin 1976](https://doi.org/10.1093/biomet/63.3.581), [Rubin 1987](https://onlinelibrary.wiley.com/doi/book/10.1002/9780470316696)).\n\nIn general, multiple imputation of a repeatedly measured continuous outcome can be done via 2 computational routes ([Roger 2022](https://baselbiometrics.github.io/home/docs/talks/20221208/5_JamesRoger%2020121118.pdf)):\n\n  1. Stepwise: split problem into separate imputations of data at each visit\n  \n      + requires monotone missingness, such as missingness due to withdrawal\n    \n      + conditions on the imputed values at previous visit\n    \n      + Bayesian linear regression problem is much simpler with monotone missing, as one can sample directly using conjugate priors\n\n  2. One-step approach (joint modelling): Fit a Bayesian full multivariate normal repeated measures model using MCMC and then draw a sample.\n\nHere, we illustrate reference-based multiple imputation of a continuous outcome measured repeatedly via the so-called one-step approach.\n\n\n### Five Macros\nThe `five macros` ([Roger 2022](https://baselbiometrics.github.io/home/docs/talks/20221208/5_JamesRoger%2020121118.pdf)), available at [LSHTM DIA Missing Data](https://www.lshtm.ac.uk/research/centres-projects-groups/missing-data#dia-missing-data), fit a Bayesian Normal RM model and then impute post withdrawal data under a series of possible post-withdrawal profiles including J2R, CIR and CR as described by [Carpenter et al. (2013)](https://www.tandfonline.com/doi/full/10.1080/10543406.2013.834911). It then analyses the data using a univariate ANOVA at each visit and summarizes across imputations using Rubin’s rules.  \n\nThe following standard and reference-based multiple imputation approaches will be illustrated here: \n    \n    * MAR (Missing At Random)\n    \n    * CIR (Copy Increment from Reference)\n    \n    * J2R (Jump to Reference)\n    \n    * CR (Copy Reference)\n\n\n## Data used\nA publicly available example [dataset](https://r-packages.io/datasets/antidepressant_data) from an antidepressant clinical trial of an active drug versus placebo is used. Overall, data of 172 patients is available with 88 patients receiving placebo and 84 receiving active drug. The same data is used for the [R part](../R/rbmi_continuous_joint.html).\n\nThe relevant endpoint is the Hamilton 17-item depression rating scale (HAMD17) which was assessed at baseline and at weeks 1, 2, 4, and 6 (visits 4-7). Study drug discontinuation occurred in 24% (20/84) of subjects from the active drug and 26% (23/88) of subjects from placebo. All data after study drug discontinuation are missing.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc print data=dat (obs=10);\n\tvar PATIENT GENDER THERAPY RELDAYS VISIT BASVAL HAMDTL17 CHANGE;\nrun;\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_ExploreData1.PNG){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\nThe number of patients per visit and arm are:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc freq data=dat;\n\ttable VISIT*THERAPY / norow nocol nopercent nocum;\nrun;\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_ExploreData2.PNG){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\nThe mean change from baseline of the endpoint (Hamilton 17-item depression rating scale, HAMD17) per visit per treatment group using only the complete cases are:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc means data=dat n mean nonobs;\n\tclass VISIT THERAPY;\n\tvar CHANGE;\nrun;\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_ExploreData3.PNG){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\nThe missingness pattern is show below. The incomplete data is primarily monotone in nature. 128 patients have complete data for all visits (all 1’s at each visit). 20, 10 and 13 patients have 1, 2 or 3 monotone missing data, respectively. Further, there is a single additional intermittent missing observation (patient 3618).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc transpose data=dat out=HAMD_wide(drop=_NAME_) prefix=CHG;\n\tby PATIENT THERAPY BASVAL;\n\tid VISIT;\n\tvar CHANGE;\nrun;\n\nproc mi data=HAMD_wide nimpute=0 displaypattern=NOMEANS;\n\tvar CHG4 CHG5 CHG6 CHG7;\nrun;\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_ExploreData4.PNG){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n## Complete case analysis\nA complete case analysis is performed using mixed model for repeated measures (MMRM) with covariates: treatment [THERAPY], gender [GENDER], visit [VISIT] as factors; baseline score [BASVAL] as continuous; and visit-by-treatment [THERAPY * VISIT] interaction, and visit-by-baseline [BASVAL * VISIT] interaction. An unstructured covariance matrix is used.\nThe **MIXED** procedure is used.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc mixed data=dat method=reml;\n\tclass THERAPY(ref=\"PLACEBO\") VISIT(ref=\"4\") PATIENT GENDER(ref=\"F\");\n\tmodel CHANGE = THERAPY GENDER VISIT BASVAL THERAPY*VISIT BASVAL*VISIT /s ddfm=satterthwaite;\n\trepeated VISIT / type=UN subject=PATIENT r;\n\tlsmeans THERAPY*VISIT / diff=control(\"PLACEBO\" \"7\") cl;\nrun;\n```\n:::\n\n\n\n\nThe parameter estimates of the fixed effects are:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_CompleteCase_fixedEstimates.PNG){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\nThe estimated unstructured covariance matrix parameters are:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_CompleteCase_covarianceEstimates.PNG){fig-align='center' width=80%}\n:::\n:::\n\n\n\nThe treatment difference at visit 7 is of interest, and is estimated to be -2.829 (se=1.117) with 95% CI of [-5.033 to -0.624] (p=0.0122).\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_CompleteCase_contrastEstimates.PNG){fig-align='center' width=90%}\n:::\n:::\n\n\n\n## Five macros: MAR approach\n\nAs described above, the so-called `five macros` will be used for the SAS implementation. The `five macros` are available at [LSHTM DIA Missing Data](https://www.lshtm.ac.uk/research/centres-projects-groups/missing-data#dia-missing-data) under Reference-based MI via Multivariate Normal RM (the \"five macros and MIWithD\"). For the details, see the use guide available in the download of the `five macros`.\n\nApplying the `five macros` for reference-based multiple imputation entails the sequential run of the following:\n\n- Part1A declares the parameter estimation model and checks consistency with the dataset. It builds a master dataset which holds details of the current job (run of the macros in sequence). It also builds indexes for the classification variables, which may be either numeric or character.\n\n- Part1B fits the parameter estimation model using the MCMC procedure and draws a pseudo-independent sample from the joint posterior distribution for the linear predictor parameters and the covariance parameters.\n\n- Part2A calculates the predicted mean under MAR, and under MNAR for each subject based on their withdrawal pattern once for each draw of the linear predictor parameter estimates. The choice of MNAR is controlled by the method used, which may vary from subject to subject.\n\n- Part2B imputes the intermediate missing values using MAR and the trailing missing values using MNAR, by deriving the conditional distribution for the missing values conditional on the observed values and covariates, using the appropriate sampled covariance parameter estimates.\n\n- Part3 carries out a univariate ANOVA analysis at selected time points usually based on the same covariates as the parameter estimation model. It then combines the least-squares means and their differences using the MIANALYZE procedure to provide final results. It is in this macro which handles the Delta methods.\n\nMost of the computation time is spent in the Part1B macro where the MCMC procedure is used to generate a sample from the posterior distribution of the full set of model parameters. These are stored away and can be used repeatedly by calling the later macros over and over again using different imputation methods.\n\nTo perform reference-based multiple imputation using MAR approach to following code is used\n\n\n::: {.cell}\n\n```{.r .cell-code}\n%part1A(jobname = HAMD, \n        Data=dat,\n        Subject=PATIENT,\n        RESPONSE = CHANGE,\n        Time = VISIT,\n        Treat = THERAPY,\n        Covbytime = BASVAL,\n        Catcov = GENDER);\n%part1B(jobname = HAMD,\n        Ndraws = 500,\n        thin = 10,\n        seed = 12345);\n%part2A(jobname = HAMD_MAR,\n        inname = HAMD,\n        method = MAR);\n%part2B(jobname = HAMD_MAR,\n        seed = 12345);\n%part3(Jobname = HAMD_MAR,\n       anref = PLACEBO,\n       Label = MAR);\n```\n:::\n\n\n\nTo print the results of the contrast at week 7 \n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc print data=HAMD_MAR_OUT;\n\twhere VISIT = \"7\";\n\tvar VISIT THERAPY _THERAPY Diff SE_Diff df Probt LCL_Diff UCL_Diff;\nrun;\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_MAR_contrast.PNG){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n## Five macros: MNAR CR approach\n\nTo perform reference-based multiple imputation using Copy Reference (CR) approach the following changes are needed in part2A of the 5 macros\n\n\n::: {.cell}\n\n```{.r .cell-code}\n%part2A(jobname = HAMD_CR,\n        inname = HAMD,\n        method = CR,\n        ref = PLACEBO);\n```\n:::\n\n\n\nThe results for M=500 imputations are\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_MNAR_CR_contrast.PNG){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n## Five macros: MNAR J2R approach\n\nTo perform reference-based multiple imputation using Jump to Reference (J2R) approach the following changes are needed in part2A of the 5 macros\n\n\n::: {.cell}\n\n```{.r .cell-code}\n%part2A(jobname = HAMD_J2R,\n        inname = HAMD,\n        method = J2R,\n        ref = PLACEBO);\n```\n:::\n\n\n\nThe results for M=500 imputations are\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_MNAR_J2R_contrast.PNG){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n## Five macros: MNAR CIR approach\n\nTo perform reference-based multiple imputation using Copy Increments in Reference (CIR) approach the following changes are needed in part2A of the 5 macros\n\n\n::: {.cell}\n\n```{.r .cell-code}\n%part2A(jobname = HAMD_CIR,\n        inname = HAMD,\n        method = CIR,\n        ref = PLACEBO);\n```\n:::\n\n\n\nThe results for M=500 imputations are\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_MNAR_CIR_contrast.PNG){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n\n## Summary of results\nIn the table we present the results of the different imputation strategies (and with varying number, *M*, of multiple imputation draws). Note that some results can be slightly different from the results above due to a possible different seed. The table show the contrast at Visit 7 between DRUG and PLACEBO [DRUG - PLACEBO]:\n\n| Method            | Estimate | SE    | 95% CI           | p-value |\n|-------------------|----------|-------|------------------|---------|\n| Complete Case     | -2.829   | 1.117 | -5.035 to -0.623 | 0.0123  |\n| MI - MAR (M=500)  | -2.810   | 1.122 | -5.029 to -0.592 | 0.0134  |\n| MI - MAR (M=2000) | -2.816   | 1.128 | -5.047 to -0.586 | 0.0137  |\n| MI - MAR (M=5000) | -2.825   | 1.123 | -5.045 to -0.605 | 0.0130  |\n| MI - MNAR CR (M=500)  | -2.384 | 1.120 | -4.598 to -0.170 | 0.0350 |\n| MI - MNAR CR (M=2000) | -2.390 | 1.118 | -4.599 to -0.180 | 0.0342 |\n| MI - MNAR CR (M=5000) | -2.400 | 1.115 | -4.604 to -0.196 | 0.0330 |\n| MI - MNAR J2R (M=500)  | -2.122 | 1.141 | -4.377 to\t0.133 | 0.0650 |\n| MI - MNAR J2R (M=2000) | -2.135 | 1.140 | -4.388 to\t0.117 | 0.0630 |\n| MI - MNAR J2R (M=5000) | -2.144 | 1.136 | -4.389 to\t0.101 | 0.0611 |\n| MI - MNAR CIR (M=500)  | -2.461 | 1.120 | -4.674 to\t-0.248 | 0.0296 |\n| MI - MNAR CIR (M=2000) | -2.469 | 1.118 | -4.679 to\t-0.260 | 0.0287 |\n| MI - MNAR CIR (M=5000) | -2.481 | 1.115 | -4.684 to\t-0.278 | 0.0276 |\n\n\n## Discussion\nA note on computational time. The total running time (including data loading, setting up data sets, MCMC run, imputing data and analysis MI data) for M=500 was about 23 seconds on a personal laptop. It increased to about 44 seconds for M=2000. Computational time was similar across difference imputation strategies.\n\nWith a small number of `Ndraws` in part1B a warning could pop-up \"There is still significant autocorrelation after 5 lags, and the effective sample size for the parameter might not be estimated accurately.\". Increasing the number of `Ndraws` will mostly solve this warning. For example, for this data example, this message is received when setting `Ndraws` below 100.\n\n\n## Appendix 1: mmrm as analysis model\nPart 3 of the 5 macros carries out a univariate ANOVA analysis at selected time points usually based on the same covariates as the parameter estimation model. It then combines the least-squares means and their differences using Rubin’s formula in a calculation similar to that in the MIANALYZE procedure to provide final results.\n\nSince, all imputed datasets are readily available (after part2B), another possibility is to analyse each imputed dataset using the analysis model of your choice, and combining the results using `PROC MIANALYZE`. For example, suppose an MMRM should be fit on each imputed dataset:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata HAMD_CR_DATAFULL;\n\tset HAMD_CR_DATAFULL;\n\t_Imputation_ = draw;\nrun;\t\n\nproc mixed data=HAMD_CR_DATAFULL ;\n\tby _Imputation_;\n  class THERAPY(ref=\"PLACEBO\") VISIT(ref=\"4\") PATIENT GENDER(ref=\"F\");\n  model CHANGE = THERAPY GENDER VISIT BASVAL THERAPY*VISIT BASVAL*VISIT /s ddfm=satterthwaite;\n  repeated VISIT /  type=UN subject=PATIENT r;\n  lsmeans THERAPY*VISIT / diff=control(\"PLACEBO\" \"7\") cl;\n  ods output Diffs=diff01;\nrun;\t\n\nproc mianalyze parms=diff01(where=(VISIT=\"7\"));\n\tclass THERAPY VISIT;\n\tmodeleffects THERAPY*VISIT;\n\tods output ParameterEstimates=res01;\nrun;\n```\n:::\n\n\n\nThe results for M=500 imputations are\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/rbmi/SAS_MNAR_mmrm.PNG){fig-align='center' width=90%}\n:::\n:::\n\n\n\n## Reference\n\n[Carpenter JR, Roger JH & Kenward MG (2013)](https://doi.org/10.1080/10543406.2013.834911). Analysis of Longitudinal Trials with Protocol Deviation: A Framework for Relevant, Accessible Assumptions, and Inference via MI. *Journal of Biopharmaceutical Statistics* 23: 1352-1371.\n\n[Five macros: Drug Information Association (DIA) Missing Data Working Group (2012)](https://www.lshtm.ac.uk/research/centres-projects-groups/missing-data#dia-missing-data). Reference-based MI via Multivariate Normal RM (the “five macros and MIWithD”). London School of Hygiene and Tropical Medicine DIA Missing Data.\n\n[PROC MIANALYZE, SAS Institute Inc. (2017)](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_mianalyze_toc.htm). SAS/STAT® 14.3 User’s Guide. Cary, NC: SAS Institute Inc.\n\n[Roger J (2022, Dec 8)](https://baselbiometrics.github.io/home/docs/talks/20221208/5_JamesRoger%2020121118.pdf). Other statistical software for continuous longitudinal endpoints: SAS macros for multiple imputation. *Addressing intercurrent events: Treatment policy and hypothetical strategies*. Joint EFSPI and BBS virtual event.\n\n[Rubin DB (1976)](https://doi.org/10.1093/biomet/63.3.581). Inference and Missing Data. *Biometrika* 63: 581–592.\n\n[Rubin DB (1987)](https://onlinelibrary.wiley.com/doi/book/10.1002/9780470316696). *Multiple Imputation for Nonresponse in Surveys*. New York: John Wiley & Sons.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}