{
  "hash": "a305492e63ea10896ae2081b01359f66",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Generalized Estimating Equations (GEE) methods in R\"\n---\n\n\n\n# INTRODUCTION\n\nGeneralized Estimating Equations (GEE) methods extend the Generalized Linear Model (GLM) framework using link functions that relate the predictors to transformed outcome variable. For dichotomous response variables, the link functions is the probit (in case of rare events complementary log-log may be preferable). For outcomes with more than two categories, the cumulative link function is used in case of ordinal variables and generalized logit for nominal variables.\n\nGEE are marginal models and therefore estimate population-averaged effects and within-subject correlation is analysed by specifying a working correlation structure (as in MMRM). Estimators are obtained via quasi-likelihood via iterative solving of estimating equations.\n\n# EXAMPLE DATA\n\nA SAS data of clinical trial data comparing two treatments for a respiratory disorder available in [\"Gee Model for Binary Data\"](https://documentation.sas.com/doc/en/statug/15.2/statug_code_genmex5.htm) in the SAS/STAT Sample Program Library \\[1\\] is used to create these examples.\n\nTo uniquely identify subjects, a new variable USUBJID was created by concatenating SITE and ID. Variables TREATMENT, BASELINE, and VISIT were renamed to TRTP, BASE, and AVISITN.\n\nAdditionally, two variables were created using randomly generated values to simulate variables with more than two categories. One was an ordinal variable with values 1, 2, and 3; the other was a nominal variable with categories 'liver', 'lung', and 'bone'. Data were created in SAS (See SAS section), and imported to R.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"readxl\")\nlibrary(readxl)\nresp <- read_excel(\"../data/resp_gee.xlsx\")\n```\n:::\n\n\n\nVariables OUTCOME, TRTP and AVISITN were converted to factors. Since the modeling functions use the first (alphabetically) level as the reference category, TRTP levels are ordered as 'P' (placebo) and 'A' (active), to ensure that placebo is used as the reference category in the models:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresp$trtp<-factor(resp$trtp, levels=c('P', 'A'))\nresp$avisitn<-factor(resp$avisitn)\nresp$outcome<-factor(resp$outcome)\nresp$usubjid<-factor(resp$usubjid)\nresp$respnom<-factor(resp$respnom)\n```\n:::\n\n\n\nGEE models are run in the next section, including treatment, visit and visit by treatment interaction as fixed effects.\n\n# PACKAGES\n\n\n\n\n\n\n\n# BINARY OUTCOME\n\nBinary outcomes can be analyzed with `geepack::geelm` \\[2\\] and and `gee::gee` \\[3\\] functions. Independence correlation matrix is used by default in both functions, and can be modified in the `corstr=` argument.\n\nBoth functions estimate robust \"Sandwich\" standard errors (SE) by default, and the gee::gee function also returns the naive SE (model-based SE).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create numeric outcome (values: 1/0).\nresp$outcome_num<-as.numeric(resp$outcome)-1\n\nmodel <- geepack::geeglm(outcome_num ~ trtp + avisitn +trtp*avisitn,\n                id=usubjid,\n                data=resp,\n                family=binomial(link='logit'),\n                corstr=\"independence\")\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\ngeepack::geeglm(formula = outcome_num ~ trtp + avisitn + trtp * \n    avisitn, family = binomial(link = \"logit\"), data = resp, \n    id = usubjid, corstr = \"independence\")\n\n Coefficients:\n               Estimate  Std.err  Wald Pr(>|W|)  \n(Intercept)    -0.03509  0.26495 0.018   0.8946  \ntrtpA           0.81280  0.39503 4.234   0.0396 *\navisitn2       -0.42921  0.26357 2.652   0.1034  \navisitn3       -0.14080  0.29834 0.223   0.6370  \navisitn4       -0.21177  0.25344 0.698   0.4034  \ntrtpA:avisitn2  0.51651  0.41043 1.584   0.2082  \ntrtpA:avisitn3  0.31861  0.42839 0.553   0.4570  \ntrtpA:avisitn4 -0.11395  0.39485 0.083   0.7729  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation structure = independence \nEstimated Scale Parameters:\n\n            Estimate Std.err\n(Intercept)        1 0.05045\nNumber of clusters:   111  Maximum cluster size: 4 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel<- gee::gee(outcome ~ trtp + avisitn + trtp*avisitn,\n            id=usubjid,\n            data=resp,\n            family=binomial(link='logit'),\n            corstr = \"independence\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nBeginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrunning glm to get initial regression estimate\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   (Intercept)          trtpA       avisitn2       avisitn3       avisitn4 \n      -0.03509        0.81280       -0.42921       -0.14080       -0.21177 \ntrtpA:avisitn2 trtpA:avisitn3 trtpA:avisitn4 \n       0.51651        0.31861       -0.11395 \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n gee S-function, version 4.13 modified 98/01/27 (1998) \n\nModel:\n Link:                      Logit \n Variance to Mean Relation: Binomial \n Correlation Structure:     Independent \n\nCall:\ngee::gee(formula = outcome ~ trtp + avisitn + trtp * avisitn, \n    id = usubjid, data = resp, family = binomial(link = \"logit\"), \n    corstr = \"independence\")\n\nSummary of Residuals:\n    Min      1Q  Median      3Q     Max \n-0.7222 -0.4561  0.2778  0.3889  0.6140 \n\n\nCoefficients:\n               Estimate Naive S.E. Naive z Robust S.E. Robust z\n(Intercept)    -0.03509     0.2674 -0.1312      0.2649  -0.1324\ntrtpA           0.81280     0.3986  2.0389      0.3950   2.0576\navisitn2       -0.42921     0.3832 -1.1200      0.2636  -1.6285\navisitn3       -0.14080     0.3788 -0.3717      0.2983  -0.4719\navisitn4       -0.21177     0.3795 -0.5580      0.2534  -0.8356\ntrtpA:avisitn2  0.51651     0.5699  0.9064      0.4104   1.2585\ntrtpA:avisitn3  0.31861     0.5700  0.5589      0.4284   0.7437\ntrtpA:avisitn4 -0.11395     0.5575 -0.2044      0.3948  -0.2886\n\nEstimated Scale Parameter:  1.018\nNumber of Iterations:  1\n\nWorking Correlation\n     [,1] [,2] [,3] [,4]\n[1,]    1    0    0    0\n[2,]    0    1    0    0\n[3,]    0    0    1    0\n[4,]    0    0    0    1\n```\n\n\n:::\n:::\n\n\n\n### PROBABILITIES AND ODDS RATIO (OR)\n\nThe estimated probabilities of event and OR can be obtained using the `emmeans` function from a `geepack::geeglm` object. The code below computes probabilities and OR, along with p-values.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- geepack::geeglm(outcome_num ~ trtp + avisitn +trtp*avisitn,\n                id=usubjid,\n                data=resp,\n                family=binomial(link='logit'),\n                corstr=\"independence\")\n\n\n#Get predicted probabilities for each treatment.\n#Get predicted probabilities for each treatment, using the covariance matrix computed by the model\nprob <- emmeans::emmeans(model, ~ trtp*avisitn, data=resp, vcov.method=vcov(model), type='response')\nprob\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n trtp avisitn  prob     SE  df lower.CL upper.CL\n P    1       0.491 0.0662 436    0.364    0.619\n A    1       0.685 0.0632 436    0.550    0.795\n P    2       0.386 0.0645 436    0.269    0.518\n A    2       0.704 0.0621 436    0.569    0.810\n P    3       0.456 0.0660 436    0.332    0.586\n A    3       0.722 0.0609 436    0.589    0.825\n P    4       0.439 0.0657 436    0.316    0.569\n A    4       0.611 0.0663 436    0.476    0.731\n\nCovariance estimate used: user-supplied \nConfidence level used: 0.95 \nIntervals are back-transformed from the logit scale \n```\n\n\n:::\n\n```{.r .cell-code}\n#Get differences between treatments by visit (option \"revpairwise\" is used to compare A vs P) \ndiffs_mean<-emmeans::emmeans(model, ~ trtp*avisitn, data=resp, vcov.method=vcov(model))\ndiffs <- emmeans::contrast(diffs_mean,\"revpairwise\" , simple=\"trtp\")\ndiffs <- as.data.frame(diffs)\n\n#Calculate CI (alpha=0.05)\nalpha<-0.05\nz_crit <- qnorm(1 - alpha / 2)\ndiffs$low<-diffs$estimate - (z_crit*diffs$SE)\ndiffs$upp<-diffs$estimate + (z_crit*diffs$SE)\n\n#Get OR applying exponential transformation;\nor<-exp(diffs$estimate)\nor_low<-exp(diffs$low)\nor_upp<-exp(diffs$up)\n\n#Get two-sided p-value\nz <- diffs$estimate/diffs$SE\npvalue <- 2 * (1 - pnorm(z))\n\n#Create a dataset with all the results\nOR<-as.data.frame(cbind(diffs$avisitn, or,or_low, or_upp, z, round(pvalue, digits=4)))\ncolnames(OR)<-c('avisit', 'OR', 'lower.CL', 'upper.CL', 'Z', 'p-value')\nOR\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  avisit    OR lower.CL upper.CL     Z p-value\n1      1 2.254   1.0393    4.889 2.058  0.0396\n2      2 3.778   1.7132    8.333 3.294  0.0010\n3      3 3.100   1.4050    6.840 2.802  0.0051\n4      4 2.011   0.9435    4.288 1.809  0.0704\n```\n\n\n:::\n:::\n\n\n\n# OUTCOME WITH MORE THAN TWO CATEGORIES\n\nThe functions used for binary outcomes above do not support outcomes with more than two categories, as these functions relay on the family function, which does not include the multinomial option. Nevertheless, the multgee package \\[4\\] provides two functions for estimating GEE models when the outcome has more than two categories:\n\nThe correlation matrix by default is \"Exchangeable\", and it can be modified using the `LORstr=` argument in both functions.\n\n### Ordinal variable\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- multgee::ordLORgee(formula = respord ~ trtp + avisitn  + trtp*avisitn,\n                   data = resp,\n                   id = usubjid,\n                   repeated = avisitn,\n                   LORstr=\"time.exch\",\n                   )\n\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGEE FOR ORDINAL MULTINOMIAL RESPONSES \nversion 1.6.0 modified 2017-07-10 \n\nLink : Cumulative logit \n\nLocal Odds Ratios:\nStructure:         time.exch\nModel:             3way\nHomogenous scores: TRUE\n\ncall:\nmultgee::ordLORgee(formula = respord ~ trtp + avisitn + trtp * \n    avisitn, data = resp, id = usubjid, repeated = avisitn, LORstr = \"time.exch\")\n\nSummary of residuals:\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-0.4704 -0.3542 -0.2854  0.0003  0.6335  0.7279 \n\nNumber of Iterations: 3 \n\nCoefficients:\n               Estimate  san.se san.z Pr(>|san.z|)  \nbeta10          -0.5472  0.2417 -2.26        0.024 *\nbeta20           0.6304  0.2551  2.47        0.013 *\ntrtpA            0.4284  0.3432  1.25        0.212  \navisitn2        -0.0024  0.3668 -0.01        0.995  \navisitn3         0.1156  0.3228  0.36        0.720  \navisitn4        -0.1470  0.3323 -0.44        0.658  \ntrtpA:avisitn2  -0.2717  0.5094 -0.53        0.594  \ntrtpA:avisitn3  -0.5974  0.4619 -1.29        0.196  \ntrtpA:avisitn4  -0.3269  0.4488 -0.73        0.466  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nLocal Odds Ratios Estimates:\n      [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]\n[1,] 0.000 0.000 1.000 0.999 1.000 0.999 1.000 0.999\n[2,] 0.000 0.000 0.999 1.281 0.999 1.281 0.999 1.281\n[3,] 1.000 0.999 0.000 0.000 1.000 0.999 1.000 0.999\n[4,] 0.999 1.281 0.000 0.000 0.999 1.281 0.999 1.281\n[5,] 1.000 0.999 1.000 0.999 0.000 0.000 1.000 0.999\n[6,] 0.999 1.281 0.999 1.281 0.000 0.000 0.999 1.281\n[7,] 1.000 0.999 1.000 0.999 1.000 0.999 0.000 0.000\n[8,] 0.999 1.281 0.999 1.281 0.999 1.281 0.000 0.000\n\np-value of Null model: 0.69 \n```\n\n\n:::\n:::\n\n\n\n### Nominal variable\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- multgee::nomLORgee(formula = respnom ~ trtp + avisitn  + trtp*avisitn,\n                   data = resp,\n                   id = usubjid,\n                   repeated = avisitn,\n                   LORstr = \"time.exch\")\n                   \n        \nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGEE FOR NOMINAL MULTINOMIAL RESPONSES \nversion 1.6.0 modified 2017-07-10 \n\nLink : Baseline Category Logit \n\nLocal Odds Ratios:\nStructure:         time.exch\nModel:             3way\nHomogenous scores: TRUE\n\ncall:\nmultgee::nomLORgee(formula = respnom ~ trtp + avisitn + trtp * \n    avisitn, data = resp, id = usubjid, repeated = avisitn, LORstr = \"time.exch\")\n\nSummary of residuals:\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n -0.444  -0.368  -0.333   0.000   0.611   0.778 \n\nNumber of Iterations: 1 \n\nCoefficients:\n                 Estimate  san.se san.z Pr(>|san.z|)\nbeta10             0.2231  0.3354  0.67         0.51\ntrtpA:1           -0.6286  0.5014 -1.25         0.21\navisitn2:1         0.1823  0.4310  0.42         0.67\navisitn3:1         0.0132  0.4786  0.03         0.98\navisitn4:1        -0.0690  0.4814 -0.14         0.89\ntrtpA:avisitn2:1   0.1625  0.6342  0.26         0.80\ntrtpA:avisitn3:1   0.9518  0.6979  1.36         0.17\ntrtpA:avisitn4:1   0.6463  0.7006  0.92         0.36\nbeta20             0.2719  0.3318  0.82         0.41\ntrtpA:2            0.0158  0.4553  0.03         0.97\navisitn2:2         0.1800  0.4254  0.42         0.67\navisitn3:2         0.1555  0.4660  0.33         0.74\navisitn4:2        -0.2719  0.5079 -0.54         0.59\ntrtpA:avisitn2:2  -0.2564  0.6025 -0.43         0.67\ntrtpA:avisitn3:2   0.1164  0.6469  0.18         0.86\ntrtpA:avisitn4:2   0.1561  0.6399  0.24         0.81\n\nLocal Odds Ratios Estimates:\n      [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]\n[1,] 0.000 0.000 1.279 1.001 1.279 1.001 1.279 1.001\n[2,] 0.000 0.000 1.001 1.000 1.001 1.000 1.001 1.000\n[3,] 1.279 1.001 0.000 0.000 1.279 1.001 1.279 1.001\n[4,] 1.001 1.000 0.000 0.000 1.001 1.000 1.001 1.000\n[5,] 1.279 1.001 1.279 1.001 0.000 0.000 1.279 1.001\n[6,] 1.001 1.000 1.001 1.000 0.000 0.000 1.001 1.000\n[7,] 1.279 1.001 1.279 1.001 1.279 1.001 0.000 0.000\n[8,] 1.001 1.000 1.001 1.000 1.001 1.000 0.000 0.000\n\np-value of Null model: 0.28 \n```\n\n\n:::\n:::\n\n\n\n# REFERENCES\n\n\\[1\\] [SAS Institute Inc.. SAS Help Center. The GEE procedure.](https://documentation.sas.com/doc/en/statug/15.2/statug_gee_examples01.htm)\n\n\\[2\\] [Generalized Estimating Equation Package](https://cran.r-project.org/web/packages/geepack/geepack.pdf)\n\n\\[3\\] [Generalized Estimation Equation Solver](https://cran.r-project.org/web/packages/gee/gee.pdf)\n\n\\[4\\] [Touloumis A. (2015). \"R Package multgee: A Generalized Estimating Equations Solver for Multinomial Responses.\" Journal of Statistical Software.](https://www.jstatsoft.org/article/view/v064i08)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}