{
  "hash": "7b5b33f0a638b5cc784a986df666a1da",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"McNemar's test in R\"\n---\n\n\n\n### Performing McNemar's test in R\n\nThe McNemar test is a statistical test used to determine if there are significant differences in the paired proportions of categorical data. It is particularly useful for testing the change in responses before and after an intervention on the same subjects, such as in pre-test/post-test study designs. By comparing the discordant pairs, where outcomes change in one direction versus the opposite, the McNemar test assesses if the intervention or treatment has a statistically significant effect on the outcome.\n\nTo demonstrate McNemar's test, data was used concerning the presence or absence of cold symptoms reported by the same children at age 12 and age 14. A total of 2638 participants were involved, with the interest being in whether the prevalence was significantly different at either age. In order to use any of the packages to calculate first we need to convert our data into a frequency table.  \n\n\n\n\n\n\n\n## Example Code using {stats}\n\nMcNemar's test can also be performed using `stats::mcnemar.test` as shown below, using the same table `X` as in the previous section.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstats::mcnemar.test(freq_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMcNemar's Chi-squared test with continuity correction\n\ndata:  freq_tbl\nMcNemar's chi-squared = 30.802, df = 1, p-value = 2.857e-08\n```\n\n\n:::\n:::\n\n\n\nThe other possible input to `mcnemar.test` is `correct =` which is a true/false value to indicate if the continuity correction should be applied. To get the result without continuity correction by specify `correct=FALSE`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstats::mcnemar.test(freq_tbl, correct = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMcNemar's Chi-squared test\n\ndata:  freq_tbl\nMcNemar's chi-squared = 31.36, df = 1, p-value = 2.144e-08\n```\n\n\n:::\n:::\n\n\n\n## Example Code using {coin}\n\nMcNemar test is calculated [without continuity correction]{.underline} which corresponds to SAS FREQ procedure (see [R v SAS McNemar’s test](https://psiaims.github.io/CAMIS/Comp/r-sas_mcnemar.html) for more details).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(coin)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: survival\n```\n\n\n:::\n\n```{.r .cell-code}\n## Asymptotic McNemar Test\n# Corresponds to SAS FREQ procedure\ncoin::mh_test(freq_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAsymptotic Marginal Homogeneity Test\n\ndata:  response by\n\t conditions (age12, age14) \n\t stratified by block\nchi-squared = 31.36, df = 1, p-value = 2.144e-08\n```\n\n\n:::\n\n```{.r .cell-code}\n## Approximative McNemar Test\ncoin::mh_test(\n  freq_tbl,\n  distribution = coin::approximate(nresample = 10000)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tApproximative Marginal Homogeneity Test\n\ndata:  response by\n\t conditions (age12, age14) \n\t stratified by block\nchi-squared = 31.36, p-value < 1e-04\n```\n\n\n:::\n\n```{.r .cell-code}\n## Exact McNemar Test\ncoin::mh_test(freq_tbl, distribution = \"exact\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tExact Marginal Homogeneity Test\n\ndata:  response by\n\t conditions (age12, age14) \n\t stratified by block\nchi-squared = 31.36, p-value = 2.331e-08\n```\n\n\n:::\n:::\n\n\n\n#### Calculating Confidence Intervals with {vcd}\n\nIt is common when calculating McNemar, to also want to check the level agreement between the two rates. To do this we use Cohen's Kappa and its associated confidence intervals. To do this, we use the `vcd` package as follows: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(vcd)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: grid\n```\n\n\n:::\n\n```{.r .cell-code}\ncohen_kappa <- vcd::Kappa(freq_tbl)\ncohen_kappa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            value     ASE     z Pr(>|z|)\nUnweighted 0.2999 0.02733 10.97 5.07e-28\nWeighted   0.2999 0.02733 10.97 5.07e-28\n```\n\n\n:::\n\n```{.r .cell-code}\nconfint(cohen_kappa, level = 0.95)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            \nKappa              lwr       upr\n  Unweighted 0.2463654 0.3534966\n  Weighted   0.2463654 0.3534966\n```\n\n\n:::\n:::\n\n\n\n#### Using the `epibasix::mcnemar` function\n\nAnother package that is sometimes used to calculate McNemar is {epibasix}. *This package isn't recommended by CAMIS*. It was found that the author is no longer maintaining the package and there was no documentation available for certain methods used. Therefore, the use of the {epibasix} package is advised against and other packages may be more suitable. \n\n#### Results\n\n`stats::mcnemar.test` and `coin::mh_test` are both sutiable options for calculating McNemar. The {coin} package also has a variety of other marginal homogeneity test, for more information [see here](https://psiaims.github.io/CAMIS/R/marginal_homogeneity_tests.html). `stats::mcnemar.test` uses a continuity correction as default but does allow for this to be removed. This function does not output any other coefficients for agreement or proportions but (if required) these can be achieved within other functions or packages in R.\n\n## Reference\n\nAgresti, A. (2002). Categorical Data Analysis, Second Edition. Hoboken, New Jersey: John Wiley & Sons.\n\nCohen, J. (1960), A coefficient of agreement for nominal scales. Educational and Psychological Measurement, 20, 37–46.\n\nEveritt, B.S. (1968), Moments of statistics kappa and weighted kappa. The British Journal of Mathematical and Statistical Psychology, 21, 97–103.\n\nFleiss, J.L., Cohen, J., and Everitt, B.S. (1969), Large sample standard errors of kappa and weighted kappa. Psychological Bulletin, 72, 332–327.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}