{
  "hash": "43883ddd9bf0ee59a9b01e554e89e73f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Wilcoxon Rank Sum (Mann Whitney-U) in R\"\n---\n\n\n\n\n\n# Overview\n\nWilcoxon rank sum test, or equivalently, Mann-Whitney U-test is a rank based non-parametric method. The aim is to compare two independent groups of observations. Under certain scenarios, it can be thought of as a test for median differences, however this is only valid when: 1) both samples are independent and identically distributed (same dispersion, same shape, not necessarily normal) and 2) are symmetric around their medians.\n\nGenerally, with two samples of observations (A and B), the test uses the mean of each possible pair of observations in each group (including the pair of each value with itself) to test if the probability that (A\\>B) \\> probability (B\\>A).\n\nThe Wilcoxon rank sum test is often presented alongside a Hodges-Lehmann estimate of the pseudo-median (the median of the Walsh averages), and an associated confidence interval for the pseudo-median.\n\nA tie in the data exists when an observation in group A, has the same result as an observation in group B.\n\n## Available R packages\n\nThere are two main implementations of the Wilcoxon rank sum test in R.\n\n-   [stats::wilcox.test](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/wilcox.test)\n\n-   [coin::wilcox_test()](https://cran.r-project.org/web/packages/coin/coin.pdf)\n\nThe `stats` package implements various classic statistical tests, including Wilcoxon rank sum test. Although this is arguably the most commonly applied package, this one does not account for any ties in the data. To account for ties in the data, the `coin` package should be used.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# x, y are two unpaired vectors. Do not necessary need to be of the same length.\nstats::wilcox.test(x, y, paired = FALSE)\n```\n:::\n\n\n\n## Example: Birth Weight\n\n*Data source: Table 30.4, Kirkwood BR. and Sterne JAC. Essentials of medical statistics. Second Edition. ISBN 978-0-86542-871-3*\n\nComparison of birth weights (kg) of children born to 15 non-smokers with those of children born to 14 heavy smokers.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# bw_ns: non smokers\n# bw_s: smokers\nbw_ns <- c(3.99, 3.89, 3.6, 3.73, 3.31, \n            3.7, 4.08, 3.61, 3.83, 3.41, \n            4.13, 3.36, 3.54, 3.51, 2.71)\nbw_s <- c(3.18, 2.74, 2.9, 3.27, 3.65, \n           3.42, 3.23, 2.86, 3.6, 3.65, \n           3.69, 3.53, 2.38, 2.34)\n```\n:::\n\n\n\nCan visualize the data on two histograms. Red lines indicate the location of medians.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow =c(1,2))\nhist(bw_ns, main = 'Birthweight: non-smokers')\nabline(v = median(bw_ns), col = 'red', lwd = 2)\nhist(bw_s, main = 'Birthweight: smokers')\nabline(v = median(bw_s), col = 'red', lwd = 2)\n```\n\n::: {.cell-output-display}\n![](nonpara_wilcoxon_ranksum_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nIt is possible to see that for non-smokers, the median birthweight is higher than those of smokers. Now we can formally test it with wilcoxon rank sum test.\n\nThe default test is two-sided with confidence level of 0.95, and does continuity correction.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# default is two sided\nstats::wilcox.test(bw_s, bw_ns, paired = FALSE, conf.int = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in wilcox.test.default(bw_s, bw_ns, paired = FALSE, conf.int = TRUE):\ncannot compute exact p-value with ties\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in wilcox.test.default(bw_s, bw_ns, paired = FALSE, conf.int = TRUE):\ncannot compute exact confidence intervals with ties\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  bw_s and bw_ns\nW = 45.5, p-value = 0.01001\nalternative hypothesis: true location shift is not equal to 0\n95 percent confidence interval:\n -0.76995896 -0.09000999\nsample estimates:\ndifference in location \n            -0.4261377 \n```\n\n\n:::\n:::\n\n\n\nWe can also carry out a one-sided test, by specifying `alternative = greater` (if the first item is greater than the second).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# default is two sided\nstats::wilcox.test(bw_ns, bw_s, paired = FALSE, alternative = 'greater')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in wilcox.test.default(bw_ns, bw_s, paired = FALSE, alternative =\n\"greater\"): cannot compute exact p-value with ties\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  bw_ns and bw_s\nW = 164.5, p-value = 0.005003\nalternative hypothesis: true location shift is greater than 0\n```\n\n\n:::\n:::\n\n\n\nIn {stats} the exact p-value is computed when there are less than 50 values and no ties otherwise the normal approximation is used. In this cause, because there are ties the normal approximation is used.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# force exact\nstats::wilcox.test(bw_s, bw_ns, paired = FALSE, conf.int = TRUE, exact = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in wilcox.test.default(bw_s, bw_ns, paired = FALSE, conf.int = TRUE, :\ncannot compute exact p-value with ties\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in wilcox.test.default(bw_s, bw_ns, paired = FALSE, conf.int = TRUE, :\ncannot compute exact confidence intervals with ties\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  bw_s and bw_ns\nW = 45.5, p-value = 0.01001\nalternative hypothesis: true location shift is not equal to 0\n95 percent confidence interval:\n -0.76995896 -0.09000999\nsample estimates:\ndifference in location \n            -0.4261377 \n```\n\n\n:::\n:::\n\n\n\nIn order to account for the ties, `wilcox_test` from the {coin} package should be used. For this function, the data needs to be inputted via a formula where the right hand side is a factor, so we need to create a dataset. In order to get smokers - non-smokers we need to relevel the factors.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmk_data <- data.frame(\n  value = c(bw_ns, bw_s), \n  smoke = as.factor(rep(c(\"non\", \"smoke\"), c(length(bw_ns), length(bw_s))))\n) \n\nsmk_data$smoke\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] non   non   non   non   non   non   non   non   non   non   non   non  \n[13] non   non   non   smoke smoke smoke smoke smoke smoke smoke smoke smoke\n[25] smoke smoke smoke smoke smoke\nLevels: non smoke\n```\n\n\n:::\n\n```{.r .cell-code}\nsmk_data$smoke <- forcats::fct_relevel(smk_data$smoke, \"smoke\")\n\nsmk_data$smoke\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] non   non   non   non   non   non   non   non   non   non   non   non  \n[13] non   non   non   smoke smoke smoke smoke smoke smoke smoke smoke smoke\n[25] smoke smoke smoke smoke smoke\nLevels: smoke non\n```\n\n\n:::\n:::\n\n\n\nNow the data is in the right shape we can run `wilcox_test`. In order to get the Hodges-Lehmann confidence intervals out, we need to include the `conf.int = TRUE` argument.(NOTE: the `conf.level` argument controls the confidence level, but must be used with `conf.int = TRUE` otherwise you won't get a confidence interval)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoin::wilcox_test(value ~ smoke, data = smk_data, conf.int  = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAsymptotic Wilcoxon-Mann-Whitney Test\n\ndata:  value by smoke (smoke, non)\nZ = -2.5974, p-value = 0.009392\nalternative hypothesis: true mu is not equal to 0\n95 percent confidence interval:\n -0.76000001 -0.09999999\nsample estimates:\ndifference in location \n            -0.4261403 \n```\n\n\n:::\n:::\n\n\n\nIn {coin} there is no option for a continuity correction and it is not done by default. {coin} can calculate exact and Monte Carlo conditional p-values using the `distribtuion` argument. The exact p-value should be used in small sample sizes as the normal approximation does not hold\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoin::wilcox_test(value ~ smoke, data = smk_data, conf.int  = TRUE,\n                  distribution = \"exact\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tExact Wilcoxon-Mann-Whitney Test\n\ndata:  value by smoke (smoke, non)\nZ = -2.5974, p-value = 0.008181\nalternative hypothesis: true mu is not equal to 0\n95 percent confidence interval:\n -0.76 -0.10\nsample estimates:\ndifference in location \n                -0.425 \n```\n\n\n:::\n:::\n\n\n\n*Note:* the distribution argument only effects the p-value, {coin} consistently calculated the exact Hodges-Lehmann confidence intervals.\n\n## Useful References\n\n-   [Methods and Formulae](https://support.minitab.com/en-us/minitab/help-and-how-to/statistics/nonparametrics/how-to/1-sample-wilcoxon/methods-and-formulas/methods-and-formulas)\n-   [Mann Whitney is not about medians in general](https://github.com/adrianolszewski/Mann-Whitney-is-not-about-medians-in-general/blob/main/Mann_Whitney_Wilcoxon_fails_as_test_of_medians_literature.md)\n-   [Relationship between walsh averages and WRS](https://stats.stackexchange.com/questions/215889/prove-the-relationship-between-walsh-averages-and-wilcoxon-signed-rank-test)\n-   [Hodges Lehmann Problems](https://aakinshin.net/posts/r-hodges-lehmann-problems)\n",
    "supporting": [
      "nonpara_wilcoxon_ranksum_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}