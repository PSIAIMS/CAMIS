{
  "hash": "de470e81b3f779b087cad393c622e95e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Survey Summary Statistics using R\"\nbibliography: ../Comp/survey-stats-summary.bib\n---\n\n\n\nWhen conducting large-scale trials on samples of the population, it can be necessary to use a more complex sampling design than a simple random sample.\n\n-   **Weighting** – If smaller populations are sampled more heavily to increase precision, then it is necessary to weight these observations in the analysis.\n\n-   **Finite population correction** – Larger samples of populations result in lower variability in comparison to smaller samples.\n\n-   **Stratification** – Dividing a population into sub-groups and sampling from each group. This protects from obtaining a very poor sample (e.g. under or over-represented groups), can give samples of a known precision, and gives more precise estimates for population means and totals.\n\n-   **Clustering** – Dividing a population into sub-groups, and only sampling certain groups. This gives a lower precision, however can be much more convenient and cheaper - for example if surveying school children you may only sample a subset of schools to avoid travelling to a school to interview a single child.\n\nAll of these designs need to be taken into account when calculating statistics, and when producing models. Only summary statistics are discussed in this document, and variances are calculated using the default Taylor series linearisation methods. For a more detailed introduction to survey statistics in R, see [@Lohr_2022] or [@tlumley_2004].\n\nWe will use the [`{survey}`](https://cran.r-project.org/web/packages/survey/index.html) package, which is the standard for survey statistics in R. Note that for those who prefer the tidyverse, the [`{srvyr}`](https://cran.r-project.org/web/packages/srvyr/index.html) package is a wrapper around `{survey}` with `{dplyr}` like syntax.\n\n# Simple Survey Designs\n\nWe will use the [API]((https://r-survey.r-forge.r-project.org/survey/html/api.html)) dataset [@API_2000], which contains a number of datasets based on different samples from a dataset of academic performance. Initially we will just cover the methodology with a simple random sample and a finite population correction to demonstrate functionality.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\n\ndata(\"api\")\n\nhead(apisrs) |> gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ndgolikyym\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ndgolikyym table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ndgolikyym thead, #ndgolikyym tbody, #ndgolikyym tfoot, #ndgolikyym tr, #ndgolikyym td, #ndgolikyym th {\n  border-style: none;\n}\n\n#ndgolikyym p {\n  margin: 0;\n  padding: 0;\n}\n\n#ndgolikyym .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ndgolikyym .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ndgolikyym .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ndgolikyym .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ndgolikyym .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ndgolikyym .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ndgolikyym .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ndgolikyym .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ndgolikyym .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ndgolikyym .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ndgolikyym .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ndgolikyym .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ndgolikyym .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ndgolikyym .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ndgolikyym .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ndgolikyym .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ndgolikyym .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ndgolikyym .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ndgolikyym .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ndgolikyym .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ndgolikyym .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ndgolikyym .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ndgolikyym .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ndgolikyym .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ndgolikyym .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ndgolikyym .gt_left {\n  text-align: left;\n}\n\n#ndgolikyym .gt_center {\n  text-align: center;\n}\n\n#ndgolikyym .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ndgolikyym .gt_font_normal {\n  font-weight: normal;\n}\n\n#ndgolikyym .gt_font_bold {\n  font-weight: bold;\n}\n\n#ndgolikyym .gt_font_italic {\n  font-style: italic;\n}\n\n#ndgolikyym .gt_super {\n  font-size: 65%;\n}\n\n#ndgolikyym .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ndgolikyym .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ndgolikyym .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ndgolikyym .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ndgolikyym .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ndgolikyym .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ndgolikyym .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#ndgolikyym .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#ndgolikyym div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"cds\">cds</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"stype\">stype</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"name\">name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sname\">sname</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"snum\">snum</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dname\">dname</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dnum\">dnum</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"cname\">cname</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"cnum\">cnum</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"flag\">flag</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pcttest\">pcttest</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"api00\">api00</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"api99\">api99</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"target\">target</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"growth\">growth</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sch.wide\">sch.wide</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"comp.imp\">comp.imp</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"both\">both</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"awards\">awards</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"meals\">meals</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ell\">ell</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"yr.rnd\">yr.rnd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mobility\">mobility</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"acs.k3\">acs.k3</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"acs.46\">acs.46</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"acs.core\">acs.core</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pct.resp\">pct.resp</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"not.hsg\">not.hsg</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"hsg\">hsg</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"some.col\">some.col</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"col.grad\">col.grad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"grad.sch\">grad.sch</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"avg.ed\">avg.ed</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"full\">full</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"emer\">emer</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"enroll\">enroll</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"api.stu\">api.stu</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pw\">pw</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"fpc\">fpc</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"cds\" class=\"gt_row gt_right\">15739081534155</td>\n<td headers=\"stype\" class=\"gt_row gt_center\">H</td>\n<td headers=\"name\" class=\"gt_row gt_left\">McFarland High</td>\n<td headers=\"sname\" class=\"gt_row gt_left\">McFarland High</td>\n<td headers=\"snum\" class=\"gt_row gt_right\">1039</td>\n<td headers=\"dname\" class=\"gt_row gt_left\">McFarland Unified</td>\n<td headers=\"dnum\" class=\"gt_row gt_right\">432</td>\n<td headers=\"cname\" class=\"gt_row gt_left\">Kern</td>\n<td headers=\"cnum\" class=\"gt_row gt_right\">14</td>\n<td headers=\"flag\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pcttest\" class=\"gt_row gt_right\">98</td>\n<td headers=\"api00\" class=\"gt_row gt_right\">462</td>\n<td headers=\"api99\" class=\"gt_row gt_right\">448</td>\n<td headers=\"target\" class=\"gt_row gt_right\">18</td>\n<td headers=\"growth\" class=\"gt_row gt_right\">14</td>\n<td headers=\"sch.wide\" class=\"gt_row gt_center\">No</td>\n<td headers=\"comp.imp\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"both\" class=\"gt_row gt_center\">No</td>\n<td headers=\"awards\" class=\"gt_row gt_center\">No</td>\n<td headers=\"meals\" class=\"gt_row gt_right\">44</td>\n<td headers=\"ell\" class=\"gt_row gt_right\">31</td>\n<td headers=\"yr.rnd\" class=\"gt_row gt_center\">NA</td>\n<td headers=\"mobility\" class=\"gt_row gt_right\">6</td>\n<td headers=\"acs.k3\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"acs.46\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"acs.core\" class=\"gt_row gt_right\">24</td>\n<td headers=\"pct.resp\" class=\"gt_row gt_right\">82</td>\n<td headers=\"not.hsg\" class=\"gt_row gt_right\">44</td>\n<td headers=\"hsg\" class=\"gt_row gt_right\">34</td>\n<td headers=\"some.col\" class=\"gt_row gt_right\">12</td>\n<td headers=\"col.grad\" class=\"gt_row gt_right\">7</td>\n<td headers=\"grad.sch\" class=\"gt_row gt_right\">3</td>\n<td headers=\"avg.ed\" class=\"gt_row gt_right\">1.91</td>\n<td headers=\"full\" class=\"gt_row gt_right\">71</td>\n<td headers=\"emer\" class=\"gt_row gt_right\">35</td>\n<td headers=\"enroll\" class=\"gt_row gt_right\">477</td>\n<td headers=\"api.stu\" class=\"gt_row gt_right\">429</td>\n<td headers=\"pw\" class=\"gt_row gt_right\">30.97</td>\n<td headers=\"fpc\" class=\"gt_row gt_right\">6194</td></tr>\n    <tr><td headers=\"cds\" class=\"gt_row gt_right\">19642126066716</td>\n<td headers=\"stype\" class=\"gt_row gt_center\">E</td>\n<td headers=\"name\" class=\"gt_row gt_left\">Stowers (Cecil </td>\n<td headers=\"sname\" class=\"gt_row gt_left\">Stowers (Cecil B.) Elementary</td>\n<td headers=\"snum\" class=\"gt_row gt_right\">1124</td>\n<td headers=\"dname\" class=\"gt_row gt_left\">ABC Unified</td>\n<td headers=\"dnum\" class=\"gt_row gt_right\">1</td>\n<td headers=\"cname\" class=\"gt_row gt_left\">Los Angeles</td>\n<td headers=\"cnum\" class=\"gt_row gt_right\">18</td>\n<td headers=\"flag\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pcttest\" class=\"gt_row gt_right\">100</td>\n<td headers=\"api00\" class=\"gt_row gt_right\">878</td>\n<td headers=\"api99\" class=\"gt_row gt_right\">831</td>\n<td headers=\"target\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"growth\" class=\"gt_row gt_right\">47</td>\n<td headers=\"sch.wide\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"comp.imp\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"both\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"awards\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"meals\" class=\"gt_row gt_right\">8</td>\n<td headers=\"ell\" class=\"gt_row gt_right\">25</td>\n<td headers=\"yr.rnd\" class=\"gt_row gt_center\">NA</td>\n<td headers=\"mobility\" class=\"gt_row gt_right\">15</td>\n<td headers=\"acs.k3\" class=\"gt_row gt_right\">19</td>\n<td headers=\"acs.46\" class=\"gt_row gt_right\">30</td>\n<td headers=\"acs.core\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pct.resp\" class=\"gt_row gt_right\">97</td>\n<td headers=\"not.hsg\" class=\"gt_row gt_right\">4</td>\n<td headers=\"hsg\" class=\"gt_row gt_right\">10</td>\n<td headers=\"some.col\" class=\"gt_row gt_right\">23</td>\n<td headers=\"col.grad\" class=\"gt_row gt_right\">43</td>\n<td headers=\"grad.sch\" class=\"gt_row gt_right\">21</td>\n<td headers=\"avg.ed\" class=\"gt_row gt_right\">3.66</td>\n<td headers=\"full\" class=\"gt_row gt_right\">90</td>\n<td headers=\"emer\" class=\"gt_row gt_right\">10</td>\n<td headers=\"enroll\" class=\"gt_row gt_right\">478</td>\n<td headers=\"api.stu\" class=\"gt_row gt_right\">420</td>\n<td headers=\"pw\" class=\"gt_row gt_right\">30.97</td>\n<td headers=\"fpc\" class=\"gt_row gt_right\">6194</td></tr>\n    <tr><td headers=\"cds\" class=\"gt_row gt_right\">30664493030640</td>\n<td headers=\"stype\" class=\"gt_row gt_center\">H</td>\n<td headers=\"name\" class=\"gt_row gt_left\">Brea-Olinda Hig</td>\n<td headers=\"sname\" class=\"gt_row gt_left\">Brea-Olinda High</td>\n<td headers=\"snum\" class=\"gt_row gt_right\">2868</td>\n<td headers=\"dname\" class=\"gt_row gt_left\">Brea-Olinda Unified</td>\n<td headers=\"dnum\" class=\"gt_row gt_right\">79</td>\n<td headers=\"cname\" class=\"gt_row gt_left\">Orange</td>\n<td headers=\"cnum\" class=\"gt_row gt_right\">29</td>\n<td headers=\"flag\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pcttest\" class=\"gt_row gt_right\">98</td>\n<td headers=\"api00\" class=\"gt_row gt_right\">734</td>\n<td headers=\"api99\" class=\"gt_row gt_right\">742</td>\n<td headers=\"target\" class=\"gt_row gt_right\">3</td>\n<td headers=\"growth\" class=\"gt_row gt_right\">-8</td>\n<td headers=\"sch.wide\" class=\"gt_row gt_center\">No</td>\n<td headers=\"comp.imp\" class=\"gt_row gt_center\">No</td>\n<td headers=\"both\" class=\"gt_row gt_center\">No</td>\n<td headers=\"awards\" class=\"gt_row gt_center\">No</td>\n<td headers=\"meals\" class=\"gt_row gt_right\">10</td>\n<td headers=\"ell\" class=\"gt_row gt_right\">10</td>\n<td headers=\"yr.rnd\" class=\"gt_row gt_center\">NA</td>\n<td headers=\"mobility\" class=\"gt_row gt_right\">7</td>\n<td headers=\"acs.k3\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"acs.46\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"acs.core\" class=\"gt_row gt_right\">28</td>\n<td headers=\"pct.resp\" class=\"gt_row gt_right\">95</td>\n<td headers=\"not.hsg\" class=\"gt_row gt_right\">5</td>\n<td headers=\"hsg\" class=\"gt_row gt_right\">9</td>\n<td headers=\"some.col\" class=\"gt_row gt_right\">21</td>\n<td headers=\"col.grad\" class=\"gt_row gt_right\">41</td>\n<td headers=\"grad.sch\" class=\"gt_row gt_right\">24</td>\n<td headers=\"avg.ed\" class=\"gt_row gt_right\">3.71</td>\n<td headers=\"full\" class=\"gt_row gt_right\">83</td>\n<td headers=\"emer\" class=\"gt_row gt_right\">18</td>\n<td headers=\"enroll\" class=\"gt_row gt_right\">1410</td>\n<td headers=\"api.stu\" class=\"gt_row gt_right\">1287</td>\n<td headers=\"pw\" class=\"gt_row gt_right\">30.97</td>\n<td headers=\"fpc\" class=\"gt_row gt_right\">6194</td></tr>\n    <tr><td headers=\"cds\" class=\"gt_row gt_right\">19644516012744</td>\n<td headers=\"stype\" class=\"gt_row gt_center\">E</td>\n<td headers=\"name\" class=\"gt_row gt_left\">Alameda Element</td>\n<td headers=\"sname\" class=\"gt_row gt_left\">Alameda Elementary</td>\n<td headers=\"snum\" class=\"gt_row gt_right\">1273</td>\n<td headers=\"dname\" class=\"gt_row gt_left\">Downey Unified</td>\n<td headers=\"dnum\" class=\"gt_row gt_right\">187</td>\n<td headers=\"cname\" class=\"gt_row gt_left\">Los Angeles</td>\n<td headers=\"cnum\" class=\"gt_row gt_right\">18</td>\n<td headers=\"flag\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pcttest\" class=\"gt_row gt_right\">99</td>\n<td headers=\"api00\" class=\"gt_row gt_right\">772</td>\n<td headers=\"api99\" class=\"gt_row gt_right\">657</td>\n<td headers=\"target\" class=\"gt_row gt_right\">7</td>\n<td headers=\"growth\" class=\"gt_row gt_right\">115</td>\n<td headers=\"sch.wide\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"comp.imp\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"both\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"awards\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"meals\" class=\"gt_row gt_right\">70</td>\n<td headers=\"ell\" class=\"gt_row gt_right\">25</td>\n<td headers=\"yr.rnd\" class=\"gt_row gt_center\">NA</td>\n<td headers=\"mobility\" class=\"gt_row gt_right\">23</td>\n<td headers=\"acs.k3\" class=\"gt_row gt_right\">23</td>\n<td headers=\"acs.46\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"acs.core\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pct.resp\" class=\"gt_row gt_right\">100</td>\n<td headers=\"not.hsg\" class=\"gt_row gt_right\">37</td>\n<td headers=\"hsg\" class=\"gt_row gt_right\">40</td>\n<td headers=\"some.col\" class=\"gt_row gt_right\">14</td>\n<td headers=\"col.grad\" class=\"gt_row gt_right\">8</td>\n<td headers=\"grad.sch\" class=\"gt_row gt_right\">1</td>\n<td headers=\"avg.ed\" class=\"gt_row gt_right\">1.96</td>\n<td headers=\"full\" class=\"gt_row gt_right\">85</td>\n<td headers=\"emer\" class=\"gt_row gt_right\">18</td>\n<td headers=\"enroll\" class=\"gt_row gt_right\">342</td>\n<td headers=\"api.stu\" class=\"gt_row gt_right\">291</td>\n<td headers=\"pw\" class=\"gt_row gt_right\">30.97</td>\n<td headers=\"fpc\" class=\"gt_row gt_right\">6194</td></tr>\n    <tr><td headers=\"cds\" class=\"gt_row gt_right\">40688096043293</td>\n<td headers=\"stype\" class=\"gt_row gt_center\">E</td>\n<td headers=\"name\" class=\"gt_row gt_left\">Sunnyside Eleme</td>\n<td headers=\"sname\" class=\"gt_row gt_left\">Sunnyside Elementary</td>\n<td headers=\"snum\" class=\"gt_row gt_right\">4926</td>\n<td headers=\"dname\" class=\"gt_row gt_left\">San Luis Coastal Unified</td>\n<td headers=\"dnum\" class=\"gt_row gt_right\">640</td>\n<td headers=\"cname\" class=\"gt_row gt_left\">San Luis Obispo</td>\n<td headers=\"cnum\" class=\"gt_row gt_right\">39</td>\n<td headers=\"flag\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pcttest\" class=\"gt_row gt_right\">99</td>\n<td headers=\"api00\" class=\"gt_row gt_right\">739</td>\n<td headers=\"api99\" class=\"gt_row gt_right\">719</td>\n<td headers=\"target\" class=\"gt_row gt_right\">4</td>\n<td headers=\"growth\" class=\"gt_row gt_right\">20</td>\n<td headers=\"sch.wide\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"comp.imp\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"both\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"awards\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"meals\" class=\"gt_row gt_right\">43</td>\n<td headers=\"ell\" class=\"gt_row gt_right\">12</td>\n<td headers=\"yr.rnd\" class=\"gt_row gt_center\">NA</td>\n<td headers=\"mobility\" class=\"gt_row gt_right\">12</td>\n<td headers=\"acs.k3\" class=\"gt_row gt_right\">20</td>\n<td headers=\"acs.46\" class=\"gt_row gt_right\">29</td>\n<td headers=\"acs.core\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pct.resp\" class=\"gt_row gt_right\">91</td>\n<td headers=\"not.hsg\" class=\"gt_row gt_right\">8</td>\n<td headers=\"hsg\" class=\"gt_row gt_right\">21</td>\n<td headers=\"some.col\" class=\"gt_row gt_right\">27</td>\n<td headers=\"col.grad\" class=\"gt_row gt_right\">34</td>\n<td headers=\"grad.sch\" class=\"gt_row gt_right\">10</td>\n<td headers=\"avg.ed\" class=\"gt_row gt_right\">3.17</td>\n<td headers=\"full\" class=\"gt_row gt_right\">100</td>\n<td headers=\"emer\" class=\"gt_row gt_right\">0</td>\n<td headers=\"enroll\" class=\"gt_row gt_right\">217</td>\n<td headers=\"api.stu\" class=\"gt_row gt_right\">189</td>\n<td headers=\"pw\" class=\"gt_row gt_right\">30.97</td>\n<td headers=\"fpc\" class=\"gt_row gt_right\">6194</td></tr>\n    <tr><td headers=\"cds\" class=\"gt_row gt_right\">19734456014278</td>\n<td headers=\"stype\" class=\"gt_row gt_center\">E</td>\n<td headers=\"name\" class=\"gt_row gt_left\">Los Molinos Ele</td>\n<td headers=\"sname\" class=\"gt_row gt_left\">Los Molinos Elementary</td>\n<td headers=\"snum\" class=\"gt_row gt_right\">2463</td>\n<td headers=\"dname\" class=\"gt_row gt_left\">Hacienda la Puente Unif</td>\n<td headers=\"dnum\" class=\"gt_row gt_right\">284</td>\n<td headers=\"cname\" class=\"gt_row gt_left\">Los Angeles</td>\n<td headers=\"cnum\" class=\"gt_row gt_right\">18</td>\n<td headers=\"flag\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pcttest\" class=\"gt_row gt_right\">93</td>\n<td headers=\"api00\" class=\"gt_row gt_right\">835</td>\n<td headers=\"api99\" class=\"gt_row gt_right\">822</td>\n<td headers=\"target\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"growth\" class=\"gt_row gt_right\">13</td>\n<td headers=\"sch.wide\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"comp.imp\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"both\" class=\"gt_row gt_center\">Yes</td>\n<td headers=\"awards\" class=\"gt_row gt_center\">No</td>\n<td headers=\"meals\" class=\"gt_row gt_right\">16</td>\n<td headers=\"ell\" class=\"gt_row gt_right\">19</td>\n<td headers=\"yr.rnd\" class=\"gt_row gt_center\">NA</td>\n<td headers=\"mobility\" class=\"gt_row gt_right\">13</td>\n<td headers=\"acs.k3\" class=\"gt_row gt_right\">19</td>\n<td headers=\"acs.46\" class=\"gt_row gt_right\">29</td>\n<td headers=\"acs.core\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"pct.resp\" class=\"gt_row gt_right\">71</td>\n<td headers=\"not.hsg\" class=\"gt_row gt_right\">1</td>\n<td headers=\"hsg\" class=\"gt_row gt_right\">8</td>\n<td headers=\"some.col\" class=\"gt_row gt_right\">20</td>\n<td headers=\"col.grad\" class=\"gt_row gt_right\">38</td>\n<td headers=\"grad.sch\" class=\"gt_row gt_right\">34</td>\n<td headers=\"avg.ed\" class=\"gt_row gt_right\">3.96</td>\n<td headers=\"full\" class=\"gt_row gt_right\">75</td>\n<td headers=\"emer\" class=\"gt_row gt_right\">20</td>\n<td headers=\"enroll\" class=\"gt_row gt_right\">258</td>\n<td headers=\"api.stu\" class=\"gt_row gt_right\">211</td>\n<td headers=\"pw\" class=\"gt_row gt_right\">30.97</td>\n<td headers=\"fpc\" class=\"gt_row gt_right\">6194</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n## Mean\n\nIf we want to calculate a mean of a variable in a dataset which has been obtained from a **s**imple **r**andom **s**ample such as `apisrs`, in R we can create a design object using the `survey::svydesign` function (specifying that there is no PSU using `id = ~1` and the finite population correction using `fpc=~fpc`).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsrs_design <- svydesign(id = ~1, fpc = ~fpc, data = apisrs)\n```\n:::\n\n\n\nThis design object stores all metadata about the sample alongside the data, and is used by all subsequent functions in the `{survey}` package. To calculate the mean, standard error, and confidence intervals of the `growth` variable, we can use the `survey::svymean` and `confint` functions:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate mean and SE of growth. The standard error will be corrected by the finite population correction specified in the design\nsrs_means <- svymean(~growth, srs_design)\n\nsrs_means\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       mean     SE\ngrowth 31.9 2.0905\n```\n\n\n:::\n\n```{.r .cell-code}\n# Use degf() to get the degrees of freedom\nconfint(srs_means, df=degf(srs_design))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          2.5 %   97.5 %\ngrowth 27.77764 36.02236\n```\n\n\n:::\n:::\n\n\n\nNote that to obtain correct results, we had to specify the degrees of freedom using the design object.\n\n## Total\n\nCalculating population totals can be done using the `survey::svytotal` function in R.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvytotal(~growth, srs_design)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        total    SE\ngrowth 197589 12949\n```\n\n\n:::\n:::\n\n\n\n## Ratios\n\nTo perform ratio analysis for means or proportions of analysis variables in R, we can `survey::svyratio`, here requesting that we do not `separate` the ratio estimation per Strata as this design is not stratified.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvy_ratio <- svyratio(\n  ~api00,\n  ~api99,\n  srs_design,\n  se=TRUE,\n  df=degf(srs_design),\n  separate=FALSE\n)\n\nsvy_ratio\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRatio estimator: svyratio.survey.design2(~api00, ~api99, srs_design, se = TRUE, \n    df = degf(srs_design), separate = FALSE)\nRatios=\n         api99\napi00 1.051066\nSEs=\n            api99\napi00 0.003603991\n```\n\n\n:::\n\n```{.r .cell-code}\nconfint(svy_ratio, df=degf(srs_design))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               2.5 %   97.5 %\napi00/api99 1.043959 1.058173\n```\n\n\n:::\n:::\n\n\n\n## Proportions\n\nTo calculate a proportion in R, we use the `svymean` function on a factor or character column:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprops <- svymean(~sch.wide, srs_design)\n\nprops\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             mean     SE\nsch.wideNo  0.185 0.0271\nsch.wideYes 0.815 0.0271\n```\n\n\n:::\n\n```{.r .cell-code}\nconfint(props, df=degf(srs_design))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                2.5 %    97.5 %\nsch.wideNo  0.1316041 0.2383959\nsch.wideYes 0.7616041 0.8683959\n```\n\n\n:::\n:::\n\n\n\nFor proportions close to 0, it can be that `survey::svyciprop` is more accurate at producing confidence intervals than `confint`.\n\n## Quantiles\n\nTo calculate quantiles in R, we can use the `survey::svyquantile` function. Note that this function was reworked in version 4.1 of `{survey}`, and prior to this had different arguments and results. The current version of `svyquantile` has an `qrule` which is similar to the `type` argument in `quantile`, and can be used to change how the quantiles are calculated. For more information, see `vignette(\"qrule\", package=\"survey\")`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvyquantile(\n  ~growth,\n  srs_design,\n  quantiles = c(0.025, 0.5, 0.975),\n  ci=TRUE,\n  se=TRUE\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$growth\n      quantile ci.2.5 ci.97.5        se\n0.025      -16    -21     -12  2.281998\n0.5         27     24      31  1.774887\n0.975       99     84     189 26.623305\n\nattr(,\"hasci\")\n[1] TRUE\nattr(,\"class\")\n[1] \"newsvyquantile\"\n```\n\n\n:::\n:::\n\n\n\n# Summary Statistics on Complex Survey Designs\n\nMuch of the previous examples and notes still stand for more complex survey designs, here we will demonstrate using a dataset from NHANES [@NHANES_2010], which uses both stratification and clustering:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"nhanes\")\n\nhead(nhanes) |> gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"soxvzcmamo\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#soxvzcmamo table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#soxvzcmamo thead, #soxvzcmamo tbody, #soxvzcmamo tfoot, #soxvzcmamo tr, #soxvzcmamo td, #soxvzcmamo th {\n  border-style: none;\n}\n\n#soxvzcmamo p {\n  margin: 0;\n  padding: 0;\n}\n\n#soxvzcmamo .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#soxvzcmamo .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#soxvzcmamo .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#soxvzcmamo .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#soxvzcmamo .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#soxvzcmamo .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#soxvzcmamo .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#soxvzcmamo .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#soxvzcmamo .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#soxvzcmamo .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#soxvzcmamo .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#soxvzcmamo .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#soxvzcmamo .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#soxvzcmamo .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#soxvzcmamo .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#soxvzcmamo .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#soxvzcmamo .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#soxvzcmamo .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#soxvzcmamo .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#soxvzcmamo .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#soxvzcmamo .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#soxvzcmamo .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#soxvzcmamo .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#soxvzcmamo .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#soxvzcmamo .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#soxvzcmamo .gt_left {\n  text-align: left;\n}\n\n#soxvzcmamo .gt_center {\n  text-align: center;\n}\n\n#soxvzcmamo .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#soxvzcmamo .gt_font_normal {\n  font-weight: normal;\n}\n\n#soxvzcmamo .gt_font_bold {\n  font-weight: bold;\n}\n\n#soxvzcmamo .gt_font_italic {\n  font-style: italic;\n}\n\n#soxvzcmamo .gt_super {\n  font-size: 65%;\n}\n\n#soxvzcmamo .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#soxvzcmamo .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#soxvzcmamo .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#soxvzcmamo .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#soxvzcmamo .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#soxvzcmamo .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#soxvzcmamo .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#soxvzcmamo .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#soxvzcmamo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SDMVPSU\">SDMVPSU</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SDMVSTRA\">SDMVSTRA</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"WTMEC2YR\">WTMEC2YR</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"HI_CHOL\">HI_CHOL</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"race\">race</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"agecat\">agecat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"RIAGENDR\">RIAGENDR</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"SDMVPSU\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SDMVSTRA\" class=\"gt_row gt_right\">83</td>\n<td headers=\"WTMEC2YR\" class=\"gt_row gt_right\">81528.77</td>\n<td headers=\"HI_CHOL\" class=\"gt_row gt_right\">0</td>\n<td headers=\"race\" class=\"gt_row gt_right\">2</td>\n<td headers=\"agecat\" class=\"gt_row gt_center\">(19,39]</td>\n<td headers=\"RIAGENDR\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"SDMVPSU\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SDMVSTRA\" class=\"gt_row gt_right\">84</td>\n<td headers=\"WTMEC2YR\" class=\"gt_row gt_right\">14509.28</td>\n<td headers=\"HI_CHOL\" class=\"gt_row gt_right\">0</td>\n<td headers=\"race\" class=\"gt_row gt_right\">3</td>\n<td headers=\"agecat\" class=\"gt_row gt_center\">(0,19]</td>\n<td headers=\"RIAGENDR\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"SDMVPSU\" class=\"gt_row gt_right\">2</td>\n<td headers=\"SDMVSTRA\" class=\"gt_row gt_right\">86</td>\n<td headers=\"WTMEC2YR\" class=\"gt_row gt_right\">12041.64</td>\n<td headers=\"HI_CHOL\" class=\"gt_row gt_right\">0</td>\n<td headers=\"race\" class=\"gt_row gt_right\">3</td>\n<td headers=\"agecat\" class=\"gt_row gt_center\">(0,19]</td>\n<td headers=\"RIAGENDR\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"SDMVPSU\" class=\"gt_row gt_right\">2</td>\n<td headers=\"SDMVSTRA\" class=\"gt_row gt_right\">75</td>\n<td headers=\"WTMEC2YR\" class=\"gt_row gt_right\">21000.34</td>\n<td headers=\"HI_CHOL\" class=\"gt_row gt_right\">0</td>\n<td headers=\"race\" class=\"gt_row gt_right\">3</td>\n<td headers=\"agecat\" class=\"gt_row gt_center\">(59,Inf]</td>\n<td headers=\"RIAGENDR\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"SDMVPSU\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SDMVSTRA\" class=\"gt_row gt_right\">88</td>\n<td headers=\"WTMEC2YR\" class=\"gt_row gt_right\">22633.58</td>\n<td headers=\"HI_CHOL\" class=\"gt_row gt_right\">0</td>\n<td headers=\"race\" class=\"gt_row gt_right\">1</td>\n<td headers=\"agecat\" class=\"gt_row gt_center\">(19,39]</td>\n<td headers=\"RIAGENDR\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"SDMVPSU\" class=\"gt_row gt_right\">2</td>\n<td headers=\"SDMVSTRA\" class=\"gt_row gt_right\">85</td>\n<td headers=\"WTMEC2YR\" class=\"gt_row gt_right\">74112.49</td>\n<td headers=\"HI_CHOL\" class=\"gt_row gt_right\">1</td>\n<td headers=\"race\" class=\"gt_row gt_right\">2</td>\n<td headers=\"agecat\" class=\"gt_row gt_center\">(39,59]</td>\n<td headers=\"RIAGENDR\" class=\"gt_row gt_right\">2</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nTo produce means and standard quartiles for this sample, taking account of sample design, we can use the following:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes_design <- svydesign(\n  data = nhanes,\n  id = ~SDMVPSU, # Specify the PSU/cluster column\n  strata = ~SDMVSTRA,  # The stratification column\n  weights = ~WTMEC2YR,  # The weighting column\n  nest = TRUE  # Allows for PSUs with the same name nested within different strata\n)\n\nsvymean(~HI_CHOL, nhanes_design, na.rm=TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           mean     SE\nHI_CHOL 0.11214 0.0054\n```\n\n\n:::\n\n```{.r .cell-code}\nsvyquantile(\n  ~HI_CHOL,\n  nhanes_design,\n  quantiles=c(0.25, 0.5, 0.75),\n  na.rm=TRUE,\n  ci=TRUE\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$HI_CHOL\n     quantile ci.2.5 ci.97.5        se\n0.25        0      0       1 0.2358596\n0.5         0      0       1 0.2358596\n0.75        0      0       1 0.2358596\n\nattr(,\"hasci\")\n[1] TRUE\nattr(,\"class\")\n[1] \"newsvyquantile\"\n```\n\n\n:::\n:::\n\n\n\nIn R, we can perform domain estimations of different sub-populations by passing our required survey function to the `svyby` function. `svyby` can also take additional options to pass to the function, for example here we pass `na.rm=TRUE` and `deff=TRUE` to `svymean`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvyby(~HI_CHOL, ~race, nhanes_design, svymean, na.rm=TRUE, deff=TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  race    HI_CHOL          se DEff.HI_CHOL\n1    1 0.10149167 0.006245843     1.082805\n2    2 0.12164921 0.006604134     1.407850\n3    3 0.07864006 0.010384645     2.091258\n4    4 0.09967861 0.024666227     3.098368\n```\n\n\n:::\n:::\n\n\n\n::: {.callout-note collapse=\"true\" title=\"Session Info\"}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.3 (2025-02-28)\n os       Ubuntu 24.04.2 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  C.UTF-8\n ctype    C.UTF-8\n tz       Europe/London\n date     2025-03-13\n pandoc   NA (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package * version date (UTC) lib source\n P survey  * 4.4-2   2024-03-20 [?] RSPM (R 4.4.0)\n\n [1] /home/michael/source/CAMIS/renv/library/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu\n [2] /opt/R/4.4.3/lib/R/library\n\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}