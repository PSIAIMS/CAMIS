{
  "hash": "bc5d241a39be72096ddb6623dd7e8be6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R vs SAS Wilcoxon Rank-Sum Test\"\n---\n\n\n\n## Introduction\n\nThis section compares the wilcoxon rank-sum test.\n\n## Wilcoxon-Rank Sum\n\nThe following table provides an overview of the support and results comparability between R and SAS for the new analysis point.\n\n+----------------------------------------------------+----------------------+---------------------+------------------+----------------------------------------------------------------------------------------------------------------------------+\n| Analysis                                           | Supported in {stats} | Supported in {coin} | Supported in SAS | Notes                                                                                                                      |\n+====================================================+======================+=====================+==================+============================================================================================================================+\n| Wilcoxon Rank-Sum                                  | ✅                   | ❌                  | ✅               | If there are ties in the dataset there will be a warning in {stats}, but the warning only refers to doing the exact method |\n|                                                    |                      |                     |                  |                                                                                                                            |\n| Normal Approximation with continuity correction    | \\                    |                     |                  |                                                                                                                            |\n+----------------------------------------------------+----------------------+---------------------+------------------+----------------------------------------------------------------------------------------------------------------------------+\n| Wilcoxon Rank-Sum                                  | ✅                   | ✅                  | ✅               |                                                                                                                            |\n|                                                    |                      |                     |                  |                                                                                                                            |\n| Normal Approximation without continuity correction |                      |                     |                  |                                                                                                                            |\n+----------------------------------------------------+----------------------+---------------------+------------------+----------------------------------------------------------------------------------------------------------------------------+\n| Wilcoxon Rank-Sum Exact                            | ✔️                   | ✅                  | ✅               | {stats} can only do the exact method when no ties are present                                                              |\n+----------------------------------------------------+----------------------+---------------------+------------------+----------------------------------------------------------------------------------------------------------------------------+\n| Hodges-Lehmann CI                                  | ✅                   | ❌                  | ✅               |                                                                                                                            |\n|                                                    |                      |                     |                  |                                                                                                                            |\n| Asymptotic                                         |                      |                     |                  |                                                                                                                            |\n+----------------------------------------------------+----------------------+---------------------+------------------+----------------------------------------------------------------------------------------------------------------------------+\n| Hodges-Lehmann CI                                  | ✔️                   | ✅                  | ✅               | {stats} can only do the exact method when no ties are present                                                              |\n|                                                    |                      |                     |                  |                                                                                                                            |\n| Exact                                              |                      |                     |                  |                                                                                                                            |\n+----------------------------------------------------+----------------------+---------------------+------------------+----------------------------------------------------------------------------------------------------------------------------+\n\n## Prerequisites: R Packages\n\nThis test can be run using the {stats} package, but in order to handle ties the {coin} package is recommended.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(coin) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: survival\n```\n\n\n:::\n:::\n\n\n\n## Example Data\n\nFor this example we are using a dataset of birth weights for smoking and non-smoking mothers.\n\n*Data source: Table 30.4, Kirkwood BR. and Sterne JAC. Essentials of medical statistics. Second Edition. ISBN 978-0-86542-871-3*\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbw_ns <- c(3.99, 3.89, 3.6, 3.73, 3.31, \n            3.7, 4.08, 3.61, 3.83, 3.41, \n            4.13, 3.36, 3.54, 3.51, 2.71)\nbw_s <- c(3.18, 2.74, 2.9, 3.27, 3.65, \n           3.42, 3.23, 2.86, 3.6, 3.65, \n           3.69, 3.53, 2.38, 2.34)\n\nsmk_data <- data.frame(\n  value = c(bw_ns, bw_s), \n  smoke = as.factor(rep(c(\"non\", \"smoke\"), c(length(bw_ns), length(bw_s))))\n) \n# Relevel the factors to make it smoker - non-smokers \nsmk_data$smoke <- forcats::fct_relevel(smk_data$smoke, \"smoke\")\nhead(smk_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  value smoke\n1  3.99   non\n2  3.89   non\n3  3.60   non\n4  3.73   non\n5  3.31   non\n6  3.70   non\n```\n\n\n:::\n:::\n\n\n\nThis dataset is both small (so an exact test is recommended) and has ties in it.\n\nTo view the code for this see the [SAS](../SAS/ranksum.qmd) and [R](../R/nonpara_wilcoxon_ranksum.qmd) pages respectively.\n\n#### Wilcoxon Rank Sum tests\n\nBelow is a table to the p-values from the Wilcoxon Rank Sum Test with different options\n\n+------------------------------------------+------------+-----------------+---------------+---------+----------------------------------------------------------+\n| Statistic                                | SAS Result | {stats} Results | {coin} Result | Match   | Notes                                                    |\n+==========================================+============+=================+===============+=========+==========================================================+\n| Normal Approx with continuity correct    | 0.01       | 0.01001         | ❌            | Yes     | {coin} doesn't have an option for continuity corrections |\n+------------------------------------------+------------+-----------------+---------------+---------+----------------------------------------------------------+\n| Normal Approx without continuity correct | 0.0094     | 0.009392        | 0.009392      | Yes     |                                                          |\n+------------------------------------------+------------+-----------------+---------------+---------+----------------------------------------------------------+\n| Exact (no correction)                    | 0.0082     | ❌              | 0.008181      | Yes     | {stats} can't do an exact method when there are ties     |\n+------------------------------------------+------------+-----------------+---------------+---------+----------------------------------------------------------+\n\n#### Hodges-Lehmann CI\n\n+--------------------+----------------+-----------------+----------------+-----------------------+----------------------------------------------------------------+\n| Statistic          | SAS Result     | {stats} Results | {coin} Result  | Match                 | Notes                                                          |\n+====================+================+=================+================+=======================+================================================================+\n| Asymptotic (Moses) | (-0.77, -0.09) | (-0.77, -0.090) | ❌             | Yes - only in {stats} | the exact argument in {coin} only applies to the rank-sum test |\n+--------------------+----------------+-----------------+----------------+-----------------------+----------------------------------------------------------------+\n| Exact              | (-0.76, -0.1)  | ❌              | (-0.76, -0.10) | Yes                   | {stats} can't do an exact method when there are ties           |\n+--------------------+----------------+-----------------+----------------+-----------------------+----------------------------------------------------------------+\n\n## Special Considerations\n\nIf you have a study where you would like to use the exact wilcoxon test and there is the risk of ties, {coin} would be recommended.\n\n## Summary and Recommendation\n\nWilcoxon Rank Sum and the associated Hodges-Lehmann CI are able to be consistenly created in both SAS and R. But, it is worth noting that the test statstic of Wilcoxon Rank Sum does not directly translate into the Hodges-Lehmann CI. Because of this, the exact option in SAS and R can be slightly confusing. In SAS the `exact wilcoxon hl;` statement is need to get both the exact p-value and CI. In {stats} exact values are only possible when there are no ties and the exact parameter is set to true (`exact = TRUE`). This will give the exact p-value and CI. In {coin} the exact option only effects the p-values, there is no option for exact CI.\n\n## Ties\n\nIn addition to the options discussed here, there are also different method to handle ties. SAS only has one option for handling ties, the [average score method](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.4/statug/statug_npar1way_details02.htm). In {coin} by default ties are handled with the \"mid-ranks\" method.\n\n## Additional References\n\nProvide references and additional reading materials for both R and SAS documentation related to the analysis.\n\n**R Documentation:**\n\n-   `wilcox.test` function: <https://rdrr.io/r/stats/wilcox.test.html>\n\n-   `wilcox_test` function: <https://rdrr.io/cran/coin/man/LocationTests.html>\n\n**SAS Documentation:**\n\n-   `PROC npar1way`: <https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.4/statug/statug_npar1way_gettingstarted.htm>\n\n::: {.callout-note collapse=\"true\" title=\"Session Info\"}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.2 (2024-10-31)\n os       macOS Sequoia 15.6\n system   aarch64, darwin20\n ui       X11\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       Europe/London\n date     2025-08-11\n pandoc   3.4 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package * version date (UTC) lib source\n P coin    * 1.4-3   2023-09-27 [?] CRAN (R 4.4.0)\n\n [1] /Users/christinafillmore/Documents/GitHub/CAMIS/renv/library/macos/R-4.4/aarch64-apple-darwin20\n [2] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library\n\n P ── Loaded and on-disk path mismatch.\n\n─ External software ──────────────────────────────────────────────────────────\n setting value\n SAS     9.04.01M7P080520\n\n──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}