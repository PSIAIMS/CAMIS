{
  "hash": "601b5b508e78d8e88ca6350986085fb6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R vs SAS CMH\"\necho: false\n---\n\n\n\n\n\n# Cochran-Mantel-Haenszel Test\n\nThe CMH procedure tests for conditional independence in partial contingency tables for a 2 x 2 x K design. However, it can be generalized to tables of X x Y x K dimensions.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nknitr::include_graphics('../images/cmh/img.png')\n```\n\n::: {.cell-output-display}\n![](../images/cmh/img.png){fig-align='center' width=162}\n:::\n:::\n\n\n\n## Naming Convention\n\nFor the remainder of this document, we adopt the following naming convention when referring to variables of a contingency table:\n\n-   X = exposure (Often the treatment variable)\n\n-   Y = response (the variable of interest)\n\n-   K = control (often a potential confounder you want to control for)\n\n## Scale\n\nThe `scale` of the exposure (X) and response (Y) variables dictate which test statistic is computed for the contingency table. Each test statistic is evaluated on different degrees of freedom (df):\n\n-   `General association` statistic (X and Y both nominal) results in `(X-1) * (Y-1) dfs`\n\n-   `Row mean` scores statistic (X is nominal and Y is ordinal) results in `X-1 dfs`\n\n-   `Nonzero correlation` statistic (X and Y both ordinal) results in `1 df`\n\n# Testing Strategy\n\n## Data\n\nTo begin investigating the differences in the SAS and R implementations of the CMH test, we decided to use the CDISC Pilot data set, which is publicly available on the PHUSE Test Data Factory repository. We applied very basic filtering conditions upfront (see below) and this data set served as the basis of the examples to follow.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv(\"../data/adcibc.csv\")\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  X      STUDYID SITEID SITEGR1     USUBJID     TRTSDT     TRTEDT\n1 1 CDISCPILOT01    701     701 01-701-1015 2014-01-02 2014-07-02\n2 2 CDISCPILOT01    701     701 01-701-1023 2012-08-05 2012-09-01\n3 3 CDISCPILOT01    701     701 01-701-1028 2013-07-19 2014-01-14\n4 4 CDISCPILOT01    701     701 01-701-1033 2014-03-18 2014-03-31\n5 5 CDISCPILOT01    701     701 01-701-1034 2014-07-01 2014-12-30\n6 6 CDISCPILOT01    701     701 01-701-1047 2013-02-12 2013-03-09\n                  TRTP TRTPN AGE AGEGR1 AGEGR1N  RACE RACEN SEX ITTFL EFFFL\n1              Placebo     0  63    <65       1 WHITE     1   F     Y     Y\n2              Placebo     0  64    <65       1 WHITE     1   M     Y     Y\n3 Xanomeline High Dose    81  71  65-80       2 WHITE     1   M     Y     Y\n4  Xanomeline Low Dose    54  74  65-80       2 WHITE     1   M     Y     Y\n5 Xanomeline High Dose    81  77  65-80       2 WHITE     1   F     Y     Y\n6              Placebo     0  85    >80       3 WHITE     1   F     Y     Y\n  COMP24FL AVISIT AVISITN             VISIT VISITNUM ADY        ADT  PARAMCD\n1        Y Week 8       8            WEEK 8        8  63 2014-03-05 CIBICVAL\n2        N Week 8       8            WEEK 4        5  29 2012-09-02 CIBICVAL\n3        Y Week 8       8            WEEK 8        8  54 2013-09-10 CIBICVAL\n4        N Week 8       8            WEEK 4        5  28 2014-04-14 CIBICVAL\n5        Y Week 8       8            WEEK 8        8  57 2014-08-26 CIBICVAL\n6        N Week 8       8 AMBUL ECG REMOVAL        6  46 2013-03-29 CIBICVAL\n        PARAM PARAMN AVAL ANL01FL DTYPE AWRANGE AWTARGET AWTDIFF AWLO AWHI  AWU\n1 CIBIC Score      1    4       Y    NA    2-84       56       7    2   84 DAYS\n2 CIBIC Score      1    3       Y    NA    2-84       56      27    2   84 DAYS\n3 CIBIC Score      1    4       Y    NA    2-84       56       2    2   84 DAYS\n4 CIBIC Score      1    4       Y    NA    2-84       56      28    2   84 DAYS\n5 CIBIC Score      1    4       Y    NA    2-84       56       1    2   84 DAYS\n6 CIBIC Score      1    4       Y    NA    2-84       56      10    2   84 DAYS\n  QSSEQ\n1  6001\n2  6001\n3  6001\n4  6001\n5  6001\n6  6001\n```\n\n\n:::\n:::\n\n\n\n## Schemes\n\nIn order to follow a systematic approach to testing, and to cover variations in the CMH test, we considered the traditional 2 x 2 x K design as well as scenarios where the generalized CMH test is employed (e.g. 5 x 3 x 3).\n\nWe present 5 archetype test scenarios that illustrate diverging results, possibly related to sparse data and possibly considered edge cases.\n\n| Number | Schema (XxYxK) | Variables                      | Relevant Test       | Description                                                                                                                             |\n|---------------|---------------|---------------|---------------|---------------|\n| 1      | 2x2x2          | X = TRTP, Y = SEX, K = AGEGR1  | General Association | TRTP and AGEGR1 were limited to two categories (removing the low dose and \\>80 year group), overall the the groups were rather balanced |\n| 2      | 3x2x3          | X = TRTP, Y = SEX, K = AGEGR1  | General Association | TRTP and AGEGR1 each have 3 levels, SEX has 2 levels, overall the the groups were rather balanced                                       |\n| 3      | 2x2x3          | X = TRTP, Y = SEX, K = RACE    | General Association | Gives back NaN in R because RACE is very imbalanced                                                                                     |\n| 6      | 2x5x2          | X = TRTP, Y = AVAL, K = SEX    | Row Means           | Compare Row Means results for R and SAS because Y is ordinal                                                                            |\n| 9      | 3x5x17         | X = TRTP, Y = AVAL, K = SITEID | Row Means           | SITEID has many strata and provokes sparse groups, AVAL is ordinal, therefore row means statistic applies here, R threw an error        |\n| 10     | 5x3x3          | X = AVAL, Y = AGEGR1, K = TRTP | Correlation         | X and Y are ordinal variables and therefore the correlation statistics has to be taken here                                             |\n\n# Results\n\nHere the results can be seen:\n\n## CMH Statistics\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsas_results <- tribble(\n  ~Scenario, ~Test, ~Chisq, ~Df, ~Prob,\n  1L ,\"Correlation\",         0.2166, 1, 0.617,\n  1L ,\"Row Means\",           0.2166, 1, 0.617,\n  1L ,\"General Association\", 0.2166, 1, 0.617,\n  2L ,\"Correlation\",         0.0009, 1, 0.9765,\n  2L ,\"Row Means\",           2.4820, 1, 0.2891,\n  2L ,\"General Association\", 2.4820, 1, 0.2891,\n  6L ,\"Correlation\",         1.1472, 1, 0.2841,\n  6L ,\"Row Means\",           1.1472, 1, 0.2841,\n  6L ,\"General Association\", 2.5672, 4, 0.6326,\n  10L ,\"Correlation\",        2.738160852, 1, 0.09797747,\n  10L ,\"Row Means\",          4.407010917,4, 0.35371641,\n  10L ,\"General Association\",5.730538193, 8, 0.67738613, \n  3L ,\"Correlation\",         0.002787130, 1, 0.95789662,\n  3L ,\"Row Means\",           2.386069847, 2, 0.30329938, \n  3L ,\"General Association\", 2.386069847, 2, 0.30329938,\n  9L ,\"Correlation\",         0.085443119, 1, 0.77005225,\n  9L ,\"Row Means\",           2.476313667, 2, 0.28991809,\n  9L ,\"General Association\", 7.033878442, 8, 0.53298189\n) |>\n  mutate(lang = \"SAS\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(vcdExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: vcd\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: grid\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: gnm\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'vcdExtra'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    summarise\n```\n\n\n:::\n\n```{.r .cell-code}\ndata2 <- data |>\n  filter(TRTPN != \"54\" & AGEGR1 != \">80\")\n\ns1 <- vcdExtra::CMHtest(\n  Freq ~ TRTP + SEX | AGEGR1,\n  data = data2,\n  overall = TRUE\n)$ALL$table\n\ns2 <- vcdExtra::CMHtest(\n  Freq ~ TRTP + SEX | AGEGR1,\n  data = data,\n  overall = TRUE\n)$ALL$table\n\ns3 <- vcdExtra::CMHtest(\n  Freq ~ TRTP + SEX | RACE,\n  data = data,\n  overall = TRUE\n)$ALL$table\n\ns6 <- vcdExtra::CMHtest(\n  Freq ~ TRTP + AVAL | SEX,\n  data = data,\n  overall = TRUE\n)$ALL$table\n\n# Unable to run\n# For large sparse table (many strata) CMHTest will occasionally throw an error in solve.default(AVA) because of singularity\n# s9 <- CMHtest(Freq ~ TRTP + AVAL | SITEID, data = data, overall = TRUE)$ALL$table\ns10 <- vcdExtra::CMHtest(\n  Freq ~ AVAL + AGEGR1 | TRTP,\n  data = data,\n  overall = TRUE\n)$ALL$table\n\nr_results <- list(s1, s2, s3, s6, s10) |>\n  map(function(x) {\n    as_tibble(x) |>\n      mutate(across(everything(), unlist), Test = rownames(x))\n  }) |>\n  reduce(bind_rows) |>\n  mutate(\n    Scenario = rep(c(1, 2, 3, 6, 10), each = 4),\n    Test = case_when(\n      Test == \"cor\" ~ \"Correlation\",\n      Test == \"rmeans\" ~ \"Row Means\",\n      Test == \"general\" ~ \"General Association\"\n    ),\n    lang = \"R\"\n  ) |>\n  filter(!is.na(Test))\n```\n:::\n\n\n\nscenarios this is a test\n\nAs it can be seen, there are two schemata where R does not provide any results:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gt)\n\nbind_rows(sas_results, r_results) |>\n  arrange(Scenario) |>\n  pivot_wider(names_from = lang, values_from = c(\"Chisq\", \"Df\", \"Prob\")) |>\n  gt(\n    groupname_col = \"Scenario\"\n  ) |>\n  tab_spanner(\n    label = \"Chi-Square\",\n    columns = starts_with(\"Chisq\")\n  ) |>\n  tab_spanner(\n    label = \"df\",\n    columns = starts_with(\"Df\")\n  ) |>\n  tab_spanner(\n    label = \"p-value\",\n    columns = starts_with(\"Prob\")\n  ) |>\n  cols_label(\n    Chisq_SAS = \"SAS\",\n    Chisq_R = \"R\",\n    Df_SAS = \"SAS\",\n    Df_R = \"R\",\n    Prob_SAS = \"SAS\",\n    Prob_R = \"R\"\n  ) |>\n  tab_options(row_group.as_column = TRUE) |>\n  tab_footnote(\n    footnote = md(\n      \"**Reason for NaN in schema 3**: Stratum k = AMERICAN INDIAN OR ALASKA NATIVE can not be compared because there are only values for one treatment and one gender.\"\n    ),\n    cells_row_groups(groups = \"3\"),\n    placement = \"right\"\n  ) |>\n  tab_footnote(\n    footnote = md(\n      \"**Reason for Error 4:**\nFor large sparse table (many strata) CMHTest will occasionally throw an error in solve.default(AVA) because of singularity\"\n    ),\n    cells_row_groups(groups = \"9\"),\n    placement = \"right\"\n  ) |>\n  opt_footnote_marks(marks = \"standard\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"kgokzihtao\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#kgokzihtao table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#kgokzihtao thead, #kgokzihtao tbody, #kgokzihtao tfoot, #kgokzihtao tr, #kgokzihtao td, #kgokzihtao th {\n  border-style: none;\n}\n\n#kgokzihtao p {\n  margin: 0;\n  padding: 0;\n}\n\n#kgokzihtao .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#kgokzihtao .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#kgokzihtao .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#kgokzihtao .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#kgokzihtao .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#kgokzihtao .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#kgokzihtao .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#kgokzihtao .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#kgokzihtao .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#kgokzihtao .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#kgokzihtao .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#kgokzihtao .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#kgokzihtao .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#kgokzihtao .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#kgokzihtao .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kgokzihtao .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#kgokzihtao .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#kgokzihtao .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#kgokzihtao .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kgokzihtao .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#kgokzihtao .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kgokzihtao .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#kgokzihtao .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kgokzihtao .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kgokzihtao .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kgokzihtao .gt_left {\n  text-align: left;\n}\n\n#kgokzihtao .gt_center {\n  text-align: center;\n}\n\n#kgokzihtao .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#kgokzihtao .gt_font_normal {\n  font-weight: normal;\n}\n\n#kgokzihtao .gt_font_bold {\n  font-weight: bold;\n}\n\n#kgokzihtao .gt_font_italic {\n  font-style: italic;\n}\n\n#kgokzihtao .gt_super {\n  font-size: 65%;\n}\n\n#kgokzihtao .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#kgokzihtao .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#kgokzihtao .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#kgokzihtao .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#kgokzihtao .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#kgokzihtao .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#kgokzihtao .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#kgokzihtao .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#kgokzihtao div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"a::stub\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"Test\">Test</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Chi-Square\">\n        <div class=\"gt_column_spanner\">Chi-Square</div>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"df\">\n        <div class=\"gt_column_spanner\">df</div>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"p-value\">\n        <div class=\"gt_column_spanner\">p-value</div>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Chisq_SAS\">SAS</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Chisq_R\">R</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Df_SAS\">SAS</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Df_R\">R</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Prob_SAS\">SAS</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Prob_R\">R</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_row_group_first\"><td headers=\"1 stub_1_1 stub_1\" rowspan=\"3\" class=\"gt_row gt_left gt_stub_row_group\">1</td>\n<td headers=\"1 stub_1_1 Test\" class=\"gt_row gt_left\">Correlation</td>\n<td headers=\"1 stub_1_1 Chisq_SAS\" class=\"gt_row gt_right\">0.21660000</td>\n<td headers=\"1 stub_1_1 Chisq_R\" class=\"gt_row gt_right\">0.2165549886</td>\n<td headers=\"1 stub_1_1 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1 stub_1_1 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1 stub_1_1 Prob_SAS\" class=\"gt_row gt_right\">0.61700000</td>\n<td headers=\"1 stub_1_1 Prob_R\" class=\"gt_row gt_right\">0.6416775</td></tr>\n    <tr><td headers=\"1 Test_2 Test\" class=\"gt_row gt_left\">Row Means</td>\n<td headers=\"1 Test_2 Chisq_SAS\" class=\"gt_row gt_right\">0.21660000</td>\n<td headers=\"1 Test_2 Chisq_R\" class=\"gt_row gt_right\">0.2165549886</td>\n<td headers=\"1 Test_2 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1 Test_2 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1 Test_2 Prob_SAS\" class=\"gt_row gt_right\">0.61700000</td>\n<td headers=\"1 Test_2 Prob_R\" class=\"gt_row gt_right\">0.6416775</td></tr>\n    <tr><td headers=\"1 Test_3 Test\" class=\"gt_row gt_left\">General Association</td>\n<td headers=\"1 Test_3 Chisq_SAS\" class=\"gt_row gt_right\">0.21660000</td>\n<td headers=\"1 Test_3 Chisq_R\" class=\"gt_row gt_right\">0.2165549886</td>\n<td headers=\"1 Test_3 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1 Test_3 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1 Test_3 Prob_SAS\" class=\"gt_row gt_right\">0.61700000</td>\n<td headers=\"1 Test_3 Prob_R\" class=\"gt_row gt_right\">0.6416775</td></tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"2 stub_1_4 stub_1\" rowspan=\"3\" class=\"gt_row gt_left gt_stub_row_group\">2</td>\n<td headers=\"2 stub_1_4 Test\" class=\"gt_row gt_left\">Correlation</td>\n<td headers=\"2 stub_1_4 Chisq_SAS\" class=\"gt_row gt_right\">0.00090000</td>\n<td headers=\"2 stub_1_4 Chisq_R\" class=\"gt_row gt_right\">0.0008689711</td>\n<td headers=\"2 stub_1_4 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"2 stub_1_4 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"2 stub_1_4 Prob_SAS\" class=\"gt_row gt_right\">0.97650000</td>\n<td headers=\"2 stub_1_4 Prob_R\" class=\"gt_row gt_right\">0.9764831</td></tr>\n    <tr><td headers=\"2 Test_5 Test\" class=\"gt_row gt_left\">Row Means</td>\n<td headers=\"2 Test_5 Chisq_SAS\" class=\"gt_row gt_right\">2.48200000</td>\n<td headers=\"2 Test_5 Chisq_R\" class=\"gt_row gt_right\">2.4820278527</td>\n<td headers=\"2 Test_5 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"2 Test_5 Df_R\" class=\"gt_row gt_right\">2</td>\n<td headers=\"2 Test_5 Prob_SAS\" class=\"gt_row gt_right\">0.28910000</td>\n<td headers=\"2 Test_5 Prob_R\" class=\"gt_row gt_right\">0.2890910</td></tr>\n    <tr><td headers=\"2 Test_6 Test\" class=\"gt_row gt_left\">General Association</td>\n<td headers=\"2 Test_6 Chisq_SAS\" class=\"gt_row gt_right\">2.48200000</td>\n<td headers=\"2 Test_6 Chisq_R\" class=\"gt_row gt_right\">2.4820278527</td>\n<td headers=\"2 Test_6 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"2 Test_6 Df_R\" class=\"gt_row gt_right\">2</td>\n<td headers=\"2 Test_6 Prob_SAS\" class=\"gt_row gt_right\">0.28910000</td>\n<td headers=\"2 Test_6 Prob_R\" class=\"gt_row gt_right\">0.2890910</td></tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"3 stub_1_7 stub_1\" rowspan=\"3\" class=\"gt_row gt_left gt_stub_row_group\">3<span class=\"gt_footnote_marks gt_asterisk\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>*</sup></span></td>\n<td headers=\"3 stub_1_7 Test\" class=\"gt_row gt_left\">Correlation</td>\n<td headers=\"3 stub_1_7 Chisq_SAS\" class=\"gt_row gt_right\">0.00278713</td>\n<td headers=\"3 stub_1_7 Chisq_R\" class=\"gt_row gt_right\">NaN</td>\n<td headers=\"3 stub_1_7 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"3 stub_1_7 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"3 stub_1_7 Prob_SAS\" class=\"gt_row gt_right\">0.95789662</td>\n<td headers=\"3 stub_1_7 Prob_R\" class=\"gt_row gt_right\">NaN</td></tr>\n    <tr><td headers=\"3 Test_8 Test\" class=\"gt_row gt_left\">Row Means</td>\n<td headers=\"3 Test_8 Chisq_SAS\" class=\"gt_row gt_right\">2.38606985</td>\n<td headers=\"3 Test_8 Chisq_R\" class=\"gt_row gt_right\">NaN</td>\n<td headers=\"3 Test_8 Df_SAS\" class=\"gt_row gt_right\">2</td>\n<td headers=\"3 Test_8 Df_R\" class=\"gt_row gt_right\">2</td>\n<td headers=\"3 Test_8 Prob_SAS\" class=\"gt_row gt_right\">0.30329938</td>\n<td headers=\"3 Test_8 Prob_R\" class=\"gt_row gt_right\">NaN</td></tr>\n    <tr><td headers=\"3 Test_9 Test\" class=\"gt_row gt_left\">General Association</td>\n<td headers=\"3 Test_9 Chisq_SAS\" class=\"gt_row gt_right\">2.38606985</td>\n<td headers=\"3 Test_9 Chisq_R\" class=\"gt_row gt_right\">NaN</td>\n<td headers=\"3 Test_9 Df_SAS\" class=\"gt_row gt_right\">2</td>\n<td headers=\"3 Test_9 Df_R\" class=\"gt_row gt_right\">2</td>\n<td headers=\"3 Test_9 Prob_SAS\" class=\"gt_row gt_right\">0.30329938</td>\n<td headers=\"3 Test_9 Prob_R\" class=\"gt_row gt_right\">NaN</td></tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"6 stub_1_10 stub_1\" rowspan=\"3\" class=\"gt_row gt_left gt_stub_row_group\">6</td>\n<td headers=\"6 stub_1_10 Test\" class=\"gt_row gt_left\">Correlation</td>\n<td headers=\"6 stub_1_10 Chisq_SAS\" class=\"gt_row gt_right\">1.14720000</td>\n<td headers=\"6 stub_1_10 Chisq_R\" class=\"gt_row gt_right\">0.1115439738</td>\n<td headers=\"6 stub_1_10 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"6 stub_1_10 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"6 stub_1_10 Prob_SAS\" class=\"gt_row gt_right\">0.28410000</td>\n<td headers=\"6 stub_1_10 Prob_R\" class=\"gt_row gt_right\">0.7383931</td></tr>\n    <tr><td headers=\"6 Test_11 Test\" class=\"gt_row gt_left\">Row Means</td>\n<td headers=\"6 Test_11 Chisq_SAS\" class=\"gt_row gt_right\">1.14720000</td>\n<td headers=\"6 Test_11 Chisq_R\" class=\"gt_row gt_right\">2.6632420358</td>\n<td headers=\"6 Test_11 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"6 Test_11 Df_R\" class=\"gt_row gt_right\">2</td>\n<td headers=\"6 Test_11 Prob_SAS\" class=\"gt_row gt_right\">0.28410000</td>\n<td headers=\"6 Test_11 Prob_R\" class=\"gt_row gt_right\">0.2640489</td></tr>\n    <tr><td headers=\"6 Test_12 Test\" class=\"gt_row gt_left\">General Association</td>\n<td headers=\"6 Test_12 Chisq_SAS\" class=\"gt_row gt_right\">2.56720000</td>\n<td headers=\"6 Test_12 Chisq_R\" class=\"gt_row gt_right\">6.5238474681</td>\n<td headers=\"6 Test_12 Df_SAS\" class=\"gt_row gt_right\">4</td>\n<td headers=\"6 Test_12 Df_R\" class=\"gt_row gt_right\">8</td>\n<td headers=\"6 Test_12 Prob_SAS\" class=\"gt_row gt_right\">0.63260000</td>\n<td headers=\"6 Test_12 Prob_R\" class=\"gt_row gt_right\">0.5887637</td></tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"9 stub_1_13 stub_1\" rowspan=\"3\" class=\"gt_row gt_left gt_stub_row_group\">9<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></td>\n<td headers=\"9 stub_1_13 Test\" class=\"gt_row gt_left\">Correlation</td>\n<td headers=\"9 stub_1_13 Chisq_SAS\" class=\"gt_row gt_right\">0.08544312</td>\n<td headers=\"9 stub_1_13 Chisq_R\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"9 stub_1_13 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"9 stub_1_13 Df_R\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"9 stub_1_13 Prob_SAS\" class=\"gt_row gt_right\">0.77005225</td>\n<td headers=\"9 stub_1_13 Prob_R\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\"9 Test_14 Test\" class=\"gt_row gt_left\">Row Means</td>\n<td headers=\"9 Test_14 Chisq_SAS\" class=\"gt_row gt_right\">2.47631367</td>\n<td headers=\"9 Test_14 Chisq_R\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"9 Test_14 Df_SAS\" class=\"gt_row gt_right\">2</td>\n<td headers=\"9 Test_14 Df_R\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"9 Test_14 Prob_SAS\" class=\"gt_row gt_right\">0.28991809</td>\n<td headers=\"9 Test_14 Prob_R\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\"9 Test_15 Test\" class=\"gt_row gt_left\">General Association</td>\n<td headers=\"9 Test_15 Chisq_SAS\" class=\"gt_row gt_right\">7.03387844</td>\n<td headers=\"9 Test_15 Chisq_R\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"9 Test_15 Df_SAS\" class=\"gt_row gt_right\">8</td>\n<td headers=\"9 Test_15 Df_R\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"9 Test_15 Prob_SAS\" class=\"gt_row gt_right\">0.53298189</td>\n<td headers=\"9 Test_15 Prob_R\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"10 stub_1_16 stub_1\" rowspan=\"3\" class=\"gt_row gt_left gt_stub_row_group\">10</td>\n<td headers=\"10 stub_1_16 Test\" class=\"gt_row gt_left\">Correlation</td>\n<td headers=\"10 stub_1_16 Chisq_SAS\" class=\"gt_row gt_right\">2.73816085</td>\n<td headers=\"10 stub_1_16 Chisq_R\" class=\"gt_row gt_right\">0.8715295423</td>\n<td headers=\"10 stub_1_16 Df_SAS\" class=\"gt_row gt_right\">1</td>\n<td headers=\"10 stub_1_16 Df_R\" class=\"gt_row gt_right\">1</td>\n<td headers=\"10 stub_1_16 Prob_SAS\" class=\"gt_row gt_right\">0.09797747</td>\n<td headers=\"10 stub_1_16 Prob_R\" class=\"gt_row gt_right\">0.3505322</td></tr>\n    <tr><td headers=\"10 Test_17 Test\" class=\"gt_row gt_left\">Row Means</td>\n<td headers=\"10 Test_17 Chisq_SAS\" class=\"gt_row gt_right\">4.40701092</td>\n<td headers=\"10 Test_17 Chisq_R\" class=\"gt_row gt_right\">3.0445270087</td>\n<td headers=\"10 Test_17 Df_SAS\" class=\"gt_row gt_right\">4</td>\n<td headers=\"10 Test_17 Df_R\" class=\"gt_row gt_right\">4</td>\n<td headers=\"10 Test_17 Prob_SAS\" class=\"gt_row gt_right\">0.35371641</td>\n<td headers=\"10 Test_17 Prob_R\" class=\"gt_row gt_right\">0.5504018</td></tr>\n    <tr><td headers=\"10 Test_18 Test\" class=\"gt_row gt_left\">General Association</td>\n<td headers=\"10 Test_18 Chisq_SAS\" class=\"gt_row gt_right\">5.73053819</td>\n<td headers=\"10 Test_18 Chisq_R\" class=\"gt_row gt_right\">5.7305381934</td>\n<td headers=\"10 Test_18 Df_SAS\" class=\"gt_row gt_right\">8</td>\n<td headers=\"10 Test_18 Df_R\" class=\"gt_row gt_right\">8</td>\n<td headers=\"10 Test_18 Prob_SAS\" class=\"gt_row gt_right\">0.67738613</td>\n<td headers=\"10 Test_18 Prob_R\" class=\"gt_row gt_right\">0.6773861</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"8\"><span class=\"gt_footnote_marks gt_asterisk\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>*</sup></span> <span data-qmd-base64=\"PHN0cm9uZz5SZWFzb24gZm9yIE5hTiBpbiBzY2hlbWEgMzwvc3Ryb25nPjogU3RyYXR1bSBrID0gQU1FUklDQU4gSU5ESUFOIE9SIEFMQVNLQSBOQVRJVkUgY2FuIG5vdCBiZSBjb21wYXJlZCBiZWNhdXNlIHRoZXJlIGFyZSBvbmx5IHZhbHVlcyBmb3Igb25lIHRyZWF0bWVudCBhbmQgb25lIGdlbmRlci4=\"><span class='gt_from_md'><strong>Reason for NaN in schema 3</strong>: Stratum k = AMERICAN INDIAN OR ALASKA NATIVE can not be compared because there are only values for one treatment and one gender.</span></span></td>\n    </tr>\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"8\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span> <span data-qmd-base64=\"PHN0cm9uZz5SZWFzb24gZm9yIEVycm9yIDQ6PC9zdHJvbmc+CkZvciBsYXJnZSBzcGFyc2UgdGFibGUgKG1hbnkgc3RyYXRhKSBDTUhUZXN0IHdpbGwgb2NjYXNpb25hbGx5IHRocm93IGFuIGVycm9yIGluIHNvbHZlLmRlZmF1bHQoQVZBKSBiZWNhdXNlIG9mIHNpbmd1bGFyaXR5\"><span class='gt_from_md'><strong>Reason for Error 4:</strong>\nFor large sparse table (many strata) CMHTest will occasionally throw an error in solve.default(AVA) because of singularity</span></span></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n# Summary and Recommendation\n\nHaving explored the available R packages to calculate the CMH statistics, using R can only be recommended if the analysis design is equivalent to 2 x 2 x K. Then, the base mantelhaen.test() function as well as the vcdExtra package show reliable results which are equal to the output of the SAS function. The same is true for the common odds ratio even though there is a marked difference in decimals.\n\nFor the generalized version of the cmh test no R package can be recommended so far. SAS and R outputs differ substantially (possibly due to the underlying subroutines or functions) and the vcdExtra package seems to deliver inconsistent results outside the 2 x 2 x K design.\n\n# References\n\nAccessible Summary: <https://online.stat.psu.edu/stat504/lesson/4/4.4>\n\nAn Introduction to Categorical Data Analysis 2nd Edition (Agresti): <http://users.stat.ufl.edu/~aa/>\n\nSAS documentation (Specification): <https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_freq_examples07.html>\n\nSAS documentation (Theoretical Basis + Formulas): <https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/procstat/procstat_freq_details92.html>\n\nOriginal Paper 1: <https://doi.org/10.2307%2F3001616>\n\nOriginal Paper 2: <https://doi.org/10.1093/jnci/22.4.719>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}