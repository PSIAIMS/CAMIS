{
  "hash": "fb39a7fca50007c9fb278a923d22c275",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R vs SAS Linear Models\"\n---\n\n\n\n# R vs. SAS ANOVA\n\n## Introduction\n\nThis section compares the implementation of analysis of variance (ANOVA) in R and SAS. ANOVA compares the mean of two or more groups to determine if at least one group is significantly different from the others.\n\nR and SAS give the same result for the linear model. But, there some differences with calculating sums of squares. If you are looking for type I sum of square that is available in base R `stats` package using the `anova()` function. Type II and Type III sum of squares are available in the `car` and the `rstatix` packages. `rstatix` uses the `car` package to calculate the sum of square, but can be considered easier to use as it handles the contrast for type III automatically.\n\n## General Comparison Table\n\nThe following table provides an overview of the support and results comparability between R and SAS for the new analysis point.\n\n+----------+----------------+------------------+---------------+------------------------------------------+\n| Analysis | Supported in R | Supported in SAS | Results Match | Notes                                    |\n+==========+================+==================+===============+==========================================+\n| ANOVA    | Yes ✅         | Yes ✅           | Mostly yes    | R can't calculate type IV Sum of Squares |\n+----------+----------------+------------------+---------------+------------------------------------------+\n\n### Matching Contrasts: R and SAS {.unnumbered}\n\n### Scenario 1: Basic Functionality\n\n#### R Code Example\n\nIn order to get the ANOVA model fit and sum of squares you can use the `anova` function in the `stats` package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n```\n\n\n:::\n\n```{.r .cell-code}\ndrug_trial <- read.csv(\"../data/drug_trial.csv\")\n\nlm_model <- lm(formula = post ~ pre + drug, data = drug_trial) \nlm_model|>\n  anova()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: post\n          Df Sum Sq Mean Sq F value    Pr(>F)    \npre        1 802.94  802.94 50.0393 1.639e-07 ***\ndrug       2  68.55   34.28  2.1361    0.1384    \nResiduals 26 417.20   16.05                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\nIt is recommended to use the `emmeans` package to get the contrasts between R.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_model |> \n  emmeans(\"drug\") |> \n  contrast(method = list(\n    \"C vs A\"  = c(-1,  1, 0),\n    \"E vs CA\" = c(-1, -1, 2)\n  ))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast estimate   SE df t.ratio p.value\n C vs A      0.109 1.80 26   0.061  0.9521\n E vs CA     6.783 3.28 26   2.067  0.0488\n```\n\n\n:::\n:::\n\n\n\nIn SAS, all contrasts must be manually defined, but the syntax is largely similar in both.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# In SAS\nproc glm data=work.mycsv;\n   class drug;\n   model post = pre drug / solution;\n   estimate 'C vs A'  drug -1  1 0;\n   estimate 'E vs CA' drug -1 -1 2;\nrun;\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/linear/clipboard-2025781059.png){fig-align='center' width=75%}\n:::\n\n::: {.cell-output-display}\n![](../images/linear/clipboard-1394032862.png){fig-align='center' width=75%}\n:::\n:::\n\n\n\n#### Results Comparison\n\nProvided below is a detailed comparison of the results obtained from both SAS and R.\n\n##### Sums of Squares\n\n+------------------------+-------------+-------------+-------------+\n| Statistic              | R Result    | SAS Result  | Match       |\n+========================+=============+=============+=============+\n| Sum of Square (Type I) | 802.94      | 802.94      | Yes         |\n|                        |             |             |             |\n|                        | 68.55       | 68.55       |             |\n+------------------------+-------------+-------------+-------------+\n| Degrees of Freedom     | 1           | 1           | Yes         |\n|                        |             |             |             |\n|                        | 2           | 2           |             |\n+------------------------+-------------+-------------+-------------+\n| Mean Square            | 802.94      | 802.94      | Yes         |\n|                        |             |             |             |\n|                        | 34.28       | 34.28       |             |\n+------------------------+-------------+-------------+-------------+\n| F Value                | 50.04       | 50.04       | Yes         |\n|                        |             |             |             |\n|                        | 2.14        | 2.14        |             |\n+------------------------+-------------+-------------+-------------+\n| p-value                | \\<0.0001    | \\<0.0001    | Yes         |\n|                        |             |             |             |\n|                        | 0.1384      | 0.1384      |             |\n+------------------------+-------------+-------------+-------------+\n\n##### Contrasts\n\n| Statistic                       | R Result | SAS Result | Match |\n|---------------------------------|----------|------------|-------|\n| ***contrast estimate C vs A***  | 0.109    | 0.109      | Yes   |\n| SE                              | 1.80     | 1.80       | Yes   |\n| t-ratio                         | 0.06     | 0.06       | Yes   |\n| p-value                         | 0.9521   | 0.9521     | Yes   |\n| ***contrast estimate E vs CA*** | 6.783    | 6.783      | Yes   |\n| SE                              | 3.28     | 3.28       | Yes   |\n| t-ratio                         | 2.07     | 2.07       | Yes   |\n| p-value                         | 0.0488   | 0.0488     | Yes   |\n\nNote, however, that there are some cases where the scale of the parameter estimates between SAS and R is off, though the test statistics and p-values are identical. In these cases, we can adjust the SAS code to include a divisor. As far as we can tell, this difference only occurs when using the predefined Base R contrast methods like `contr.helmert`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproc glm data=work.mycsv;\n   class drug;\n   model post = pre drug / solution;\n   estimate 'C vs A'  drug -1  1 0 / divisor = 2;\n   estimate 'E vs CA' drug -1 -1 2 / divisor = 6;\nrun;\n```\n:::\n\n\n\n## Summary and Recommendation\n\nThere were no major differences between the R emmeans package and the SAS PROC GLM step in conducting ANOVA on the clinical trial data. Both are robust software tools that generate mostly same results. Scaling for parameter coefficients need to be handled with care however as contrast estimates between R and S differed by a sign.\n\n## Additional References\n\nProvide references and additional reading materials for both R and SAS documentation related to the analysis.\n\n**R Documentation:**\n\n-   `lm` function: <https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/lm>\n-   `emmeans` package: <https://cran.r-project.org/web/packages/emmeans/>\n\n**SAS Documentation:**\n\n-   `PROC GLM`: <https://documentation.sas.com/doc/en/statug/15.2/statug_glm_syntax01.htm>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}