{
  "hash": "1c71b4ef50ef2871004c65ff290d6a8c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R v SAS McNemar's test\"\n---\n\n\n\n## Introduction\n\nMcNemar's test is a test of marginal homogeneity. That is used with 2x2 contingency tables, when both x and y are binary factors.\n\n## General Comparison Table\n\nThe following table provides an overview of the support and results comparability between R and SAS for the new analysis point.\n\n| Analysis | Supported in R | Supported in SAS | Results Match | Notes |\n|---------------|---------------|---------------|---------------|---------------|\n| McNemar's Chi-Squared test | [Yes](../R/mcnemar.qmd) | [Yes](../SAS/mcnemar.qmd) | ✅ | By default SAS doesn't include the continuity correction. In R use {stats} or {coin} |\n| Cohen's Kappa CI | [Yes](../R/mcnemar.qmd) | [Yes](../SAS/mcnemar.qmd) | ✅ | In R use {vcd} |\n\nIn R,the {stats} or the {coin} package can be used to calculate McNemar. The {coin} package has the same defaults as SAS. But, using either of these packages, the first step is to calculate a frequency table, using the table function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(coin)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: survival\n```\n\n\n:::\n\n```{.r .cell-code}\ncolds <- \n  read.csv(\n    file = \"../data/colds.csv\")\nfreq_tbl <- table(\"age12\" = colds$age12, \"age14\" = colds$age14)\nfreq_tbl\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     age14\nage12  No Yes\n  No  707 256\n  Yes 144 212\n```\n\n\n:::\n\n```{.r .cell-code}\ncoin::mh_test(freq_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAsymptotic Marginal Homogeneity Test\n\ndata:  response by\n\t conditions (age12, age14) \n\t stratified by block\nchi-squared = 31.36, df = 1, p-value = 2.144e-08\n```\n\n\n:::\n:::\n\n\n\nIn order to get Cohen's Kappa an additional package is needed.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(vcd)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: grid\n```\n\n\n:::\n\n```{.r .cell-code}\ncohen_kappa <- Kappa(freq_tbl)\ncohen_kappa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            value     ASE     z Pr(>|z|)\nUnweighted 0.2999 0.02733 10.97 5.07e-28\nWeighted   0.2999 0.02733 10.97 5.07e-28\n```\n\n\n:::\n\n```{.r .cell-code}\nconfint(cohen_kappa, level = 0.95)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            \nKappa              lwr       upr\n  Unweighted 0.2463654 0.3534966\n  Weighted   0.2463654 0.3534966\n```\n\n\n:::\n:::\n\n\n\nThe FREQ procedure can be used in SAS with the AGREE option to run the McNemar test, with OR, and RISKDIFF options stated for production of odds ratios and risk difference. These options were added as `epibasix::mcNemar` outputs the odds ratio and risk difference with confidence limits as default. In contrast to R, SAS outputs the Kappa coefficients with confident limits as default.\n\n``` sas\nproc freq data=colds;\n    tables age12*age14 / agree or riskdiff;\nrun;\n```\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/mcnemar/sas-mcnemar.png){fig-align='center' width=40%}\n:::\n:::\n\n\n\n## Summary and Recommendation\nWhen calculating the odds ratio and risk difference confidence limits, SAS is not treating the data as matched-pairs. There is advice on the SAS blog and SAS support page to amend this, which requires a lot of additional coding.\n\n{stats} is using Edward's continuity correction by default, but this can be removed. In contrast, there is no option to include Edward's continuity correction in SAS, but this can be manually coded to agree with R. However, its use is controversial due to being seen as overly conservative.\n\nThere is another R package that is sometimes used to calculate McNemar's, called `epibasix`. This package is no longer being maintained, and there was no documentation available for certain methods used. Therefore, the use of the `epibasix` package is advised against and other packages may be more suitable.\n\n::: {.callout-note collapse=\"true\" title=\"Session Info\"}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.2 (2024-10-31 ucrt)\n os       Windows 11 x64 (build 26100)\n system   x86_64, mingw32\n ui       RTerm\n language (EN)\n collate  English_United States.utf8\n ctype    English_United States.utf8\n tz       America/Chicago\n date     2025-08-19\n pandoc   3.4 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package * version date (UTC) lib source\n P coin    * 1.4-3   2023-09-27 [?] RSPM (R 4.4.0)\n\n [1] C:/Users/ljohn71/Desktop/CAMIS/renv/library/windows/R-4.4/x86_64-w64-mingw32\n [2] C:/Users/ljohn71/AppData/Local/Programs/R/R-4.4.2/library\n\n P ── Loaded and on-disk path mismatch.\n\n─ External software ──────────────────────────────────────────────────────────\n setting value\n SAS     9.04.01M7P080520\n\n──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n:::\n\n",
    "supporting": [
      "r-sas_mcnemar_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}